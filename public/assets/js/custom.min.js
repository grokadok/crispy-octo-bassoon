const is_explorer=navigator.userAgent.indexOf("MSIE")>-1,is_firefox=navigator.userAgent.indexOf("Firefox")>-1,is_opera=navigator.userAgent.toLowerCase().indexOf("op")>-1;let is_chrome=navigator.userAgent.indexOf("Chrome")>-1,is_safari=navigator.userAgent.indexOf("Safari")>-1;function appendChildren(e,t){for(const s of t)e.appendChild(s)}function arrayCompare(e,t){let s=[],n=[],i=[];for(el of e)t.includes(el)?i.push(el):s.push(el);for(el of t)e.includes(el)||n.push(el);return{only_1:s,only_2:n,both:i}}function blurElements(e){const t=e=>e.classList.add("blurred");if(Array.isArray(e))for(let s of e)t(s);else t(e)}function capitalize(e){let t=[];for(const s of e.split(" "))t.push(s.charAt().toUpperCase()+s.slice(1));return t.join(" ")}function cloneAndReplace(e){let t;if(Array.isArray(e)){t=[];for(const s of e)t.push(s.parentNode.replaceChild(s.cloneNode(!0),s))}else t=e.parentNode.replaceChild(e.cloneNode(!0),e);return t}function commentUp(e){e.classList.add("up")}function commentDown(e){Array.isArray(e)?e.forEach((e=>e.classList.remove("up"))):e.classList.remove("up")}function convertRemToPixels(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}function disable(e){const t=e=>e.disabled=!0;if(Array.isArray(e))for(let s of e)t(s);else t(e)}function elEnableTimer(e){const t=e=>{!1===e.hidden&&setTimeout((function(){enable(e)}),20)};if(Array.isArray(e))for(const s of e)t(s);else t(e)}function emptyEl(e){if(Array.isArray(e))for(const t of e)t.classList.add("hidden","loading"),t.textContent="";else e.classList.add("hidden","loading"),e.textContent=""}function emptyModal(e){let t=Array.from(e.getElementsByTagName("input")).concat(Array.from(e.getElementsByTagName("textarea"))),s=Array.from(e.getElementsByClassName("selectize-selected"));resetFields(t),removeChildren(s,!0)}function enable(e){const t=e=>e.disabled=!1;if(Array.isArray(e))for(let s of e)t(s);else t(e)}function fadeIn(e,t){const s=e=>{e.hidden=!1,e.disabled=!1,e.getElementsByTagName("input").length>0&&enable(e.getElementsByTagName("input")[0]),"phone-container"===e.id&&e.getElementsByClassName("iti__selected-flag")[0].setAttribute("tabindex","0"),setTimeout(e.classList.remove("fadeout"),50),t&&t.dropdown&&hideOnClickOutside(e,e.closest(".field"))};if(Array.isArray(e))for(let t of e)s(t);else s(e)}function fadeOut(e,t){const s=e=>{e.disabled=!0,e.classList.add("fadeout"),e.getElementsByTagName("input").length>0&&disable(e.getElementsByTagName("input")[0]),void 0!==t&&!0===t.hide&&setTimeout((()=>{e.hidden=!0}),600),"phone-container"===e.id&&e.getElementsByClassName("iti__selected-flag")[0].removeAttribute("tabindex")};if(Array.isArray(e))for(let t of e)s(t);else s(e)}function fetchDataTimer(e,t){if(clearTimeout(timer),void 0!==t.selectize)if(e.value)timer=setTimeout((()=>{fetchSelectizeData(e,t.selectize)}),50);else{clearTimeout(timer);let t=e.parentNode.getElementsByTagName("ul")[0];fadeOut(t),removeChildren(t,!0)}}function hideOnClickOutside(e,t){const s=t??e,n=t=>{s.contains(t.target)||e.classList.contains("fadeout")||fadeOut(e),document.removeEventListener("click",n)};document.addEventListener("click",n)}function highlightSearch(e,t){Array.isArray(t)&&(t=t.map((e=>normalizePlus(e))).filter((e=>""!==e)).join("|"));const s=new RegExp(`((^|\\b|\\w+)(${t})($|\\b|\\w+))`,"gi"),n=e=>{e.innerHTML=e.innerHTML.replace(/(<mark>|<\/mark>)/gim,""),e.innerHTML=e.textContent.replace(s,"<mark>$&</mark>")};if(Array.isArray(e))for(let t of e)n(t);else n(e)}function invalidate(e){e.classList.contains("valid")?e.classList.replace("valid","invalid"):e.classList.add("invalid")}function loadIn(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t].classList.add("loading"),e[t].classList.remove("hidden");else e.classList.add("loading"),e.classList.remove("hidden")}function loadOut(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t].classList.remove("loading");else e.classList.remove("loading")}function normalizePlus(e){return e.trim().toLocaleLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function refreshTabData(e,t){const s=Tabulator.findTable(".tabulator");if(s)for(const n of s){const s=n.element.closest("fieldset").getAttribute("data-t");if((!t||t.includes(parseInt(s)))&&e.contains(n.element)){const e={f:parseInt(6),t:parseInt(s)};socket.send(e)}}}function removeAttributes(e,t){if(void 0!==t)for(const s of t)e.removeAttribute(s);else{let t=[];for(let s=0;s<e.attributes.length;s++){let n=e.attributes[s].name;"class"!=n&&t.push(n)}t.forEach((t=>e.removeAttribute(t)))}}function removeChildren(e,t=!1){if(action=e=>{let s,n=e.children.length-1,i=!1===t?0:-1;for(s=n;s>i;s--)e.children[s].remove()},Array.isArray(e))for(let t of e)action(t);else action(e)}function removeOptions(e,t=!1){let s,n=e.options.length-1,i=!1===t?0:-1;if(n>=0)for(s=n;s>i;s--)e.options[s].remove()}function resetFields(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t].value="";else e.value=""}function resetAllFields(){Array.from(document.getElementsByTagName("input")).forEach((e=>e.value=""))}function resetModal(e){tabuDestroy(e),removeAttributes(e),e.getElementsByTagName("h2")[0].textContent="";for(let t=1;e.children.length>2;)e.children[t].remove();return e}function selectText(e){if(document.body.createTextRange){const t=document.body.createTextRange();t.moveToElementText(e),t.select()}else if(window.getSelection){const t=window.getSelection(),s=document.createRange();s.selectNodeContents(e),t.removeAllRanges(),t.addRange(s)}else console.warn("Could not select text in node: Unsupported browser.")}function setElementAttributes(e,t){for(let[s,n]of t)("number"==typeof n||n)&&e.setAttribute(s,n)}function setElementDraggable(e,t){if("absolute"!==e.style.position&&"absolute"!==getComputedStyle(e).position)return msg.new({content:"Element must have position set to absolute.",type:"danger"});e.classList.add("drag"),e.onpointerdown=function(s){if(["div","ul","li","nav"].includes(s.target.tagName.toLowerCase())){const a=e.getBoundingClientRect(),o=t?.parent?t.parent.getBoundingClientRect():e.offsetParent.getBoundingClientRect(),r=s.clientX-a.left,l=s.clientY-a.top,c=o.x,d=o.y;function n(s,n){let i,a;if(e.classList.remove("left","right","top","bottom"),o&&t?.constrain){const t=s-r-c,h=n-l-d,p=o.right-e.offsetWidth-c,u=o.bottom-e.offsetHeight-d;i=t<0?0:t>p?p:t,a=h<0?0:h>u?u:h}else i=s-r-c,a=n-l-d;t?.magnet&&(s-o.left<100&&(i=0,e.classList.add("left")),o.right-s<100&&(i=o.right-e.offsetWidth,e.classList.add("right")),n-o.top<100&&(a=0,e.classList.add("top")),o.bottom-n<100&&(a=o.bottom-e.offsetHeight,e.classList.add("bottom"))),e.style.left=i+"px",e.style.top=a+"px"}function i(e){e.preventDefault(),n(e.pageX,e.pageY)}e.classList.add("up"),e.classList.remove("left","right","top","bottom"),n(s.pageX,s.pageY),document.addEventListener("pointermove",i);const h=e=>{e.classList.remove("up"),t?.magnet&&((e.classList.contains("left")||e.classList.contains("right"))&&(e.style.left=""),(e.classList.contains("top")||e.classList.contains("bottom"))&&(e.style.top="",e.style.left=""))};document.addEventListener("pointerup",(()=>{document.removeEventListener("pointermove",i),h(e)}),{once:!0}),document.body.addEventListener("pointerleave",(()=>{document.removeEventListener("pointermove",i),h(e)}),{once:!0})}},e.ondragstart=()=>!1}function setElementResizable(e,t){}function tabuDestroy(e){let t=Tabulator.findTable(".tabulator");const s=e=>{for(const s of t)e.contains(s.element)&&s.destroy()};if(t)if(Array.isArray(e))for(const t of e)s(t);else s(e)}function toggleClasses(e,t){for(const s of t.classes)if(e.classList.contains(s)){const n=t.classes.indexOf(s);return e.classList.remove(s),void(n+1!==t.classes.length||t.none?n+1<t.classes.length&&e.classList.add(t.classes[n+1]):e.classList.add(t.classes[0]))}t.none?e.classList.add(t.classes[0]):console.error("toggleClasses: no class present on element and none:false.")}function togglePw(e){const t=e.getElementsByTagName("input")[0],s=t.getAttribute("type"),n=e.getElementsByTagName("svg")[0].getElementsByTagName("path");"password"===s?(t.setAttribute("type","text"),n[0].classList.add("hide"),n[1].classList.remove("hide")):"text"===s&&(t.setAttribute("type","password"),n[0].classList.remove("hide"),n[1].classList.add("hide"))}function unblurElements(e){const t=e=>e.classList.remove("blurred");if(Array.isArray(e))for(const s of e)t(s);else t(e)}function unsetElementDraggable(e){e.onmousedown=null,e.classList.remove("drag","up")}function validate(e){e.classList.contains("invalid")?e.classList.replace("invalid","valid"):e.classList.add("valid")}is_chrome&&is_safari&&(is_safari=!1),is_chrome&&is_opera&&(is_chrome=!1);class BopAlert{constructor(){this.wrapper=document.getElementsByClassName("msg")[0],this.wrapper.setAttribute("role","alertdialog"),this.message=this.wrapper.getElementsByTagName("span")[0],this.buttons=this.wrapper.getElementsByTagName("button"),this.btn0=this.buttons[0],this.btn1=this.buttons[1],this.btn2=this.buttons[2],this.store=[],this.reset()}close(){null===this.wrapper.getAttribute("open")?console.warn("No open BopAlert to close."):(this.wrapper.close(),this.store.shift(),this.status=void 0,this.store.length>0&&this.show(this.store[0]))}new(e){e!==this.status&&(this.store.push(e),null===this.wrapper.getAttribute("open")&&this.show(e))}show(e){this.reset(),this.status=e,this.message.textContent=e.content;const t=e.type??"theme";this.wrapper.classList.add(t),e.btn1text?(this.btn0.textContent="annuler",this.btn0.className="danger",this.btn1.hidden=!1,this.btn1.textContent=e.btn1text,this.btn1.classList.add(e.btn1style??"success"),e.btn1listener&&this.btn1.addEventListener("click",e.btn1listener),e.btn2text&&(this.btn2.hidden=!1,this.btn2.textContent=e.btn2text,this.btn2.classList.add(e.btn2style??"info"),e.btn2listener&&this.btn2.addEventListener("click",e.btn2listener))):this.btn0.className=t??"theme",this.btn0.addEventListener("click",(function(){e.btn0listener&&e.btn0listener(),msg.close()})),this.wrapper.showModal(),elEnableTimer(Array.from(this.buttons)),setTimeout((()=>{this.btn0.focus()}),50)}reset(){disable(Array.from(this.buttons)),cloneAndReplace(Array.from(this.buttons)),this.btn0=this.buttons[0],this.btn1=this.buttons[1],this.btn2=this.buttons[2],this.btn1.hidden=!0,this.btn2.hidden=!0,this.btn0.textContent="ok",this.wrapper.className="msg"}}const msg=new BopAlert;class BopChat{static chats=[];constructor(e,t){if(BopChat.chats.push(this),this.id=BopChat.chats.indexOf(this),this.active=0,this.chats=[],this.wrapper=e,this.header=document.createElement("div"),this.chatTabs=document.createElement("div"),this.content=document.createElement("div"),this.users=document.createElement("ul"),this.footer=document.createElement("div"),this.input=document.createElement("textarea"),this.inviteButton=document.createElement("button"),this.sendButton=document.createElement("button"),this.typingToggle=0,this.usersButton=document.createElement("button"),"chat"===e.id&&(this.chatButton=document.createElement("button"),this.emailButton=document.createElement("button"),this.minmaxButton=document.createElement("button"),this.searchButton=document.createElement("button"),this.ul=document.createElement("ul"),this.searchTab=document.createElement("div"),this.searchTab.className="search fadeout",this.searchTab.hidden=!0,this.searchTab.textContent="Vous pouvez utiliser la zone d'écriture ci dessous pour chercher un utilisateur avec qui ouvrir un chat.",this.searchTab.setAttribute("data-i",0),this.content.append(this.searchTab),this.footer.append(this.ul),this.chatButton.textContent="📟",this.chatButton.addEventListener("click",(()=>{this.chatButton.blur(),this.wrapper.classList.toggle("toggle"),this.wrapper.classList.contains("max")&&!this.wrapper.classList.contains("toggle")&&(this.minmaxButton.classList.remove("btn-down"),this.wrapper.classList.remove("max"))})),this.emailButton.textContent="📠",this.emailButton.addEventListener("click",(()=>{this.writeEmail()})),this.minmaxButton.textContent="▫︎◻︎",this.minmaxButton.addEventListener("click",(()=>{this.minmaxButton.blur(),this.wrapper.classList.toggle("max"),this.wrapper.classList.contains("max")?this.minmaxButton.classList.add("btn-down"):this.minmaxButton.classList.remove("btn-down")})),this.searchButton.textContent="🔎",this.searchButton.setAttribute("data-i",0),this.searchButton.addEventListener("click",(()=>{this.searchButton.blur(),this.showTab(this.searchTab)})),this.header.append(this.chatButton,this.minmaxButton,this.searchButton)),this.wrapper.classList.add("user-min"),this.chatTabs.setAttribute("tabindex","-1"),this.usersButton.textContent="👤",this.usersButton.addEventListener("click",(()=>{this.usersButton.blur(),toggleClasses(this.wrapper,{classes:["user-min","user-max"],none:!0})})),this.header.append(this.chatTabs,this.usersButton),setElementAttributes(this.input,[["data-f","7"],["data-s","8"],["rows","1"]]),this.input.addEventListener("input",(()=>{this.active>0&&!this.inviteButton.classList.contains("btn-down")?this.typing():(0===this.active||this.inviteButton.classList.contains("btn-down"))&&(this.input.value?socket.send({c:this.active>0?this.active:null,f:7,i:this.input.value,s:8,x:0}):fadeOut(this.ul)),this.input.style.height="auto",this.input.style.height=this.input.scrollHeight+"px"})),this.input.addEventListener("keydown",(e=>{switch(e.code){case"Enter":e.preventDefault(),e.shiftKey?this.input.value+="\n":this.input.value&&this.validate();break;case"ArrowUp":!this.ul.classList.contains("fadeout")&&this.ul.children.length>0&&this.ul.children[0].focus()}})),this.inviteButton.textContent="+",this.inviteButton.addEventListener("click",(()=>{this.inviteButton.blur(),this.inviteButton.classList.toggle("btn-down"),this.inviteButton.classList.contains("btn-down")?(this.input.focus(),fadeOut(this.sendButton),this.input.value&&socket.send({c:this.active>0?this.active:null,f:7,i:this.input.value,s:8,x:0})):this.inviteButton.classList.contains("btn-down")||fadeIn(this.sendButton),fadeOut(this.ul)})),this.sendButton.textContent="➤",this.sendButton.addEventListener("click",(()=>{this.validate()})),this.footer.append(this.inviteButton,this.input,this.sendButton),this.wrapper.append(this.header,this.content,this.users,this.footer),this.wrapper.classList.add("bopchat"),t.length>0)for(const e of t)socket.send({f:14,i:e});else this.showTab(this.searchTab)}addChat(e){let t,s,n;this.chats.includes(e.id)?(s=this.content.querySelector(`[data-i="${e.id}"]`),n=s.getElementsByTagName("datalist")[0],t=this.chatTabs.querySelector(`[data-i="${e.id}"]`),s.innerHTML="",removeOptions(n,!0)):(this.chats.push(e.id),t=document.createElement("button"),s=document.createElement("div"),s.setAttribute("data-i",e.id),n=document.createElement("datalist"),t.textContent=e.name,t.setAttribute("data-i",e.id),this.chatTabs.append(t),this.content.append(s),t.addEventListener("click",(()=>{t.blur(),this.active!==e.id?this.showTab(s):msg.new({content:`Souhaitez-vous fermer l'onglet ${e.name} ?`,btn1text:"Fermer",btn1listener:()=>{socket.send({f:19,i:e.id}),msg.close()}})})));for(const t of e.participants){let e=document.createElement("option");e.value=t.name,setElementAttributes(e,[["data-id",t.iduser],["data-position",t.position],["data-avatar",t.image??t.name.split(" ").map((e=>e.substring(1,0))).join("").toUpperCase()],["data-status",t.status]]),n.append(e)}s.append(n);for(const t of e.content)this.addMessage(t);this.showTab(s)}addMessage(e){let t=this.content.querySelector(`[data-i="${e.idchat}"]`);if(t){let s,n=document.createElement("fieldset"),i=document.createElement("div"),a=t.querySelector(`[data-id="${e.iduser}"]`),o=document.createElement("legend"),r=document.createElement("span"),l=document.createElement("span");const c=Array.from(t.querySelectorAll("button")),d=new Date(1e3*e.created),h=new Date,p=h.getTime()-d.getTime(),u=7*864e5;setElementAttributes(n,[["data-t",e.created],["data-i",e.iduser],["data-readby",e.readby]]),n.className=a.getAttribute("data-position"),o.textContent=a.value,r.textContent=e.content;const m=a.getAttribute("data-avatar");"/"===m.substring(0,1)?i.style.backgroundImage=m:i.textContent=m,n.append(o,l,i,r),l.textContent=d.toLocaleTimeString(window.navigator.language,{hour:"2-digit",minute:"2-digit"}),d.toLocaleDateString()!==h.toLocaleDateString()||c.find((e=>"Aujourd'hui"===e.textContent))?d.toLocaleDateString()!==h.toLocaleDateString()&&p<u&&!c.find((e=>e.textContent===capitalize(d.toLocaleString(window.navigator.language,{weekday:"long",day:"numeric"}))))?(s=document.createElement("button"),s.className="theme",s.textContent=capitalize(d.toLocaleString(window.navigator.language,{weekday:"long",day:"numeric"})),t.insertBefore(s,t.firstChild),s.addEventListener("click",(()=>{s.blur();for(let e=Array.from(t.children).indexOf(s)-1;e>=0&&"fieldset"===t.children[e].tagName.toLowerCase();e--)t.children[e].classList.toggle("fadeout")}))):p>u&&!c.find((e=>e.textContent===d.toLocaleDateString(window.navigator.language,{weekday:"long",day:"numeric",month:"long",year:"numeric"})))&&(s=document.createElement("button"),s.className="theme",s.textContent=d.toLocaleString(window.navigator.language,{weekday:"long",day:"numeric",month:"long",year:"numeric"}),t.insertBefore(s,t.firstChild),s.addEventListener("click",(()=>{s.blur();for(let e=Array.from(t.children).indexOf(s)-1;e>=0&&"fieldset"===t.children[e].tagName.toLowerCase();e--)t.children[e].classList.toggle("fadeout")}))):(s=document.createElement("button"),s.className="theme",s.textContent="Aujourd'hui",t.insertBefore(s,t.firstChild),s.addEventListener("click",(()=>{s.blur();const e=Array.from(t.children).indexOf(s);for(let s=0;s<e;s++)t.children[s].classList.toggle("fadeout")}))),t.insertBefore(n,t.firstChild),n.className,t.scrollTop=t.scrollHeight}}addUser(e){userId=e.id,userName=e.name,userImg=e.img,userImg?avatar.style.backgroundImage=userImg:(avatar.style.backgroundColor=color,avatar.textContent=userName.split(" ").map((e=>e.substring(1,0))).join(""))}collapse(){this.wrapper.classList.remove("toggle","max")}destroy(){this.wrapper.innerHTML="",this.wrapper.className="loading hidden",BopChat.chats.splice(BopChat.chats.indexOf(this),1)}static destroyAll(){for(const e of BopChat.chats)e.destroy()}expand(){this.wrapper.classList.add("toggle")}maximize(){this.wrapper.classList.add("max")}minimize(){this.wrapper.classList.remove("max")}parseData(e){const t=this.input,s=this.ul;if(e.response[0])if(e.response[0].fail)msg.new({content:e.response[0].fail,btn0listener:()=>t.focus()}),t.value=t.value.trim();else if(e.response[0].content){let n=[];removeChildren(s,!0);for(const t of e.response){const e=`${t.id}`;if(null!==t.id&&!n.includes(e)){let n=document.createElement("li"),i=document.createElement("span");if(n.setAttribute("data-select",e),n.setAttribute("tabindex","0"),i.textContent=t.content,n.append(i),t.secondary){let e=document.createElement("span");e.textContent=`(${t.secondary})`,n.append(e)}if(t.role){const e=t.role.split(",");for(const t of e){let e=document.createElement("button");e.textContent=t,e.disabled=!0,n.append(e)}}if(t.email){n.setAttribute("data-email",t.email);let e=document.createElement("span");e.textContent=`(${t.email})`,i.insertAdjacentElement("afterend",e)}(t.status&&1===t.status||t.inchat&&1===t.inchat)&&n.classList.add("offline"),s.append(n)}}highlightSearch(Array.from(s.getElementsByTagName("span")),t.value.split(" "));for(const e of s.children)e.addEventListener("keydown",(e=>this.selectizeKeysNav(e))),e.addEventListener("click",(e=>{this.request([parseInt(e.currentTarget.getAttribute("data-select"))]),this.input.value="",this.inviteButton.classList.remove("btn-down"),fadeIn(this.sendButton),fadeOut(this.ul)}));s.children.length>0?fadeIn(s,{dropdown:s.closest("fieldset")}):fadeOut(s)}else fadeOut(s);else fadeOut(s)}refresh(e){socket.send({f:14,i:e})}remove(e){const t=this.content.querySelector(`[data-i='${e}']`),s=this.chatTabs.querySelector(`[data-i='${e}']`);this.active===e&&this.showTab(t.previousElementSibling),t.remove(),s.remove(),this.chats.splice(this.chats.indexOf(e),1)}request(e){socket.send({f:17,i:e,c:this.active>0?this.active:void 0})}selectizeKeysNav(e){switch(e.code){case"ArrowUp":e.preventDefault(),e.currentTarget.nextSibling?.focus();break;case"ArrowDown":e.preventDefault(),e.currentTarget.previousSibling?e.currentTarget.previousSibling.focus():this.input[0].focus();break;case"Enter":case"Space":e.currentTarget.classList.contains("offline")||(this.request([parseInt(e.currentTarget.getAttribute("data-select"))]),this.input.value="",this.inviteButton.classList.remove("btn-down"),fadeIn(this.sendButton),fadeOut(this.ul));break;case"Escape":e.preventDefault(),fadeOut(this.ul),this.input[0].blur()}}send(e){socket.send({i:e.id,m:e.message,f:16}),this.input.disabled=!0}showTab(e){const t=parseInt(e.getAttribute("data-i"));if(t!==this.active){let s=Array.from(this.content.children);if(s.splice(s.indexOf(e),1),fadeOut(s),this.active>0?this.chatTabs.querySelector(`[data-i='${this.active}']`).classList.remove("btn-down"):this.header.classList.remove("search"),this.inviteButton.classList.contains("btn-down")&&(fadeIn(this.sendButton),this.inviteButton.classList.remove("btn-down")),t>0){fadeOut(this.ul),fadeIn([this.inviteButton,this.sendButton]),this.users.innerHTML="";for(const t of Array.from(e.getElementsByTagName("datalist")[0].children))if(parseInt(t.getAttribute("data-status"))<2){let e=document.createElement("li"),s=document.createElement("div"),n=document.createElement("div");s.textContent=t.value,e.setAttribute("data-id",t.getAttribute("data-id")),e.setAttribute("data-position",t.getAttribute("data-position")),e.className=t.getAttribute("data-position"),1===parseInt(t.getAttribute("data-status"))&&e.classList.add("offline");const i=t.getAttribute("data-avatar");"/"===i.substring(0,1)?n.style.backgroundImage=i:n.textContent=i,e.append(n,s),this.users.append(e),fadeIn([this.usersButton,this.users])}}else this.users.innerHTML="",fadeOut([this.inviteButton,this.sendButton,this.usersButton,this.users]);fadeIn(e),this.input.focus(),this.active=t,this.active>0?this.chatTabs.querySelector(`[data-i='${this.active}']`).classList.add("btn-down"):this.header.classList.add("search")}}async typing(){0===this.typingToggle&&this.input.value&&(socket.send({f:15,i:this.active}),this.typingToggle=1,this.typingTimeout=setTimeout((()=>{this.typingToggle=0}),5e3))}updateUsers(e){if(this.content.querySelector(`[data-i='${e.id}']`)){let t=[],s=this.content.querySelector(`[data-i='${e.id}']`).getElementsByTagName("datalist")[0];s.innerHTML="";for(const n of e.participants){let e=document.createElement("option");e.value=n.name,setElementAttributes(e,[["data-id",n.iduser],["data-position",n.position],["data-avatar",n.image??n.name.split(" ").map((e=>e.substring(1,0))).join("").toUpperCase()],["data-status",n.status]]),t.push(n.iduser),s.append(e)}if(this.active===parseInt(e.id)){let e=[],n=this.users.children;for(let t of n)e.push(parseInt(t.getAttribute("data-id")));const i=arrayCompare(t,e);for(const e of i.only_1){const t=s.querySelector(`[data-id='${e}']`);if(parseInt(t.getAttribute("data-status"))<2){let s=document.createElement("li"),n=document.createElement("div"),i=document.createElement("div");n.textContent=t.value,s.setAttribute("data-id",e),s.setAttribute("data-position",t.getAttribute("data-position")),s.className=t.getAttribute("data-position")+" fadeout",1===parseInt(t.getAttribute("data-status"))&&s.classList.add("offline");const a=t.getAttribute("data-avatar");"/"===a.substring(0,1)?i.style.backgroundImage=a:i.textContent=a,s.append(i,n),this.users.append(s),fadeIn(s)}}for(const e of i.only_2)el=this.users.querySelector(`[data-id='${e}']`),el.remove();for(const e of i.both){switch(parseInt(s.querySelector(`[data-id='${e}']`).getAttribute("data-status"))){case 0:this.users.querySelector(`[data-id='${e}']`).classList.remove("offline");break;case 1:this.users.querySelector(`[data-id='${e}']`).classList.add("offline");break;case 2:this.users.querySelector(`[data-id='${e}']`).remove()}}}}}validate(){this.sendButton.blur(),this.input.disabled=!0,this.send({id:this.active,message:this.input.value})}writeEmail(){}}class BopTable{static tables=[];constructor(e){if(void 0===e.task&&void 0===e.rows)return console.error("BopTable: no data set.");0===BopTable.tables.length&&document.addEventListener("click",BopTable.menuListener),BopTable.tables.push(this),this.id=BopTable.tables.indexOf(this),this.wrapper=e.wrapper,this.header=document.createElement("div"),this.table=document.createElement("div"),this.table.setAttribute("role","grid"),this.thead=document.createElement("div"),this.tbody=document.createElement("div"),this.footer=document.createElement("div"),this.rowHeight=e.row?.height??2,this.wrapper.className="boptable",this.search={},this.scroll={},this.menu={},this.menu.wrapper=document.createElement("ul"),this.menu.wrapper.setAttribute("role","menu"),this.menu.search=document.createElement("li"),this.menu.colsDrop=document.createElement("ul"),this.menu.icons=document.createElement("li");let t=document.createElement("li"),s=document.createElement("div"),n=document.createElement("span");this.menu.icons.innerHTML='<div class="show">\n            <svg viewBox="0 0 24 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" tabindex="0">\n                <g>\n                    <path d="M17.882,18.297C16.123,19.413 14.083,20.003 12,20C6.608,20 2.122,16.12 1.181,11C1.611,8.671 2.783,6.543 4.521,4.934L1.392,1.808L2.807,0.393L22.606,20.193L21.191,21.607L17.882,18.297ZM5.935,6.35C4.576,7.586 3.629,9.209 3.223,11C3.535,12.367 4.162,13.641 5.054,14.723C5.946,15.804 7.078,16.663 8.36,17.229C9.641,17.796 11.038,18.056 12.438,17.988C13.838,17.92 15.203,17.526 16.424,16.838L14.396,14.81C13.533,15.354 12.51,15.588 11.496,15.475C10.482,15.361 9.537,14.906 8.816,14.185C8.094,13.463 7.639,12.518 7.526,11.504C7.412,10.49 7.646,9.467 8.19,8.604L5.935,6.35ZM12.914,13.328L9.672,10.086C9.494,10.539 9.452,11.034 9.552,11.51C9.651,11.987 9.887,12.424 10.231,12.768C10.575,13.112 11.012,13.348 11.489,13.448C11.965,13.547 12.46,13.505 12.913,13.327L12.914,13.328ZM20.807,15.592L19.376,14.162C20.045,13.209 20.52,12.135 20.777,11C20.505,9.81 19.994,8.687 19.275,7.701C18.556,6.714 17.644,5.884 16.594,5.261C15.544,4.638 14.378,4.234 13.168,4.076C11.957,3.917 10.727,4.006 9.552,4.338L7.974,2.76C9.221,2.27 10.58,2 12,2C17.392,2 21.878,5.88 22.819,11C22.513,12.666 21.824,14.238 20.807,15.592ZM11.723,6.508C12.36,6.469 12.997,6.565 13.594,6.791C14.19,7.017 14.732,7.367 15.182,7.818C15.634,8.268 15.983,8.81 16.209,9.407C16.435,10.003 16.531,10.641 16.492,11.277L11.723,6.508Z" style="fill-rule:nonzero;"/>\n                </g>\n                <g transform="matrix(1,0,0,1,1,2)">\n                    <path d="M11,0C16.392,0 20.878,3.88 21.819,9C20.879,14.12 16.392,18 11,18C5.608,18 1.122,14.12 0.181,9C1.121,3.88 5.608,0 11,0ZM11,16C13.04,16 15.018,15.307 16.613,14.035C18.207,12.764 19.323,10.988 19.777,9C19.321,7.013 18.205,5.24 16.611,3.97C15.016,2.7 13.038,2.009 11,2.009C8.962,2.009 6.984,2.7 5.389,3.97C3.795,5.24 2.679,7.013 2.223,9C2.677,10.988 3.793,12.764 5.387,14.035C6.982,15.307 8.961,16 11,16ZM11,13.5C9.807,13.5 8.662,13.026 7.818,12.182C6.974,11.338 6.5,10.194 6.5,9C6.5,7.807 6.974,6.662 7.818,5.818C8.662,4.974 9.807,4.5 11,4.5C12.194,4.5 13.338,4.974 14.182,5.818C15.026,6.662 15.5,7.807 15.5,9C15.5,10.194 15.026,11.338 14.182,12.182C13.338,13.026 12.194,13.5 11,13.5ZM11,11.5C11.663,11.5 12.299,11.237 12.768,10.768C13.237,10.299 13.5,9.663 13.5,9C13.5,8.337 13.237,7.701 12.768,7.232C12.299,6.763 11.663,6.5 11,6.5C10.337,6.5 9.701,6.763 9.232,7.232C8.763,7.701 8.5,8.337 8.5,9C8.5,9.663 8.763,10.299 9.232,10.768C9.701,11.237 10.337,11.5 11,11.5Z" style="fill-rule:nonzero;"/>\n                </g>\n            </svg>\n        </div>\n        <div>\n            <svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n                <path d="M18 0V2H17L12 9.5V18H6V9.5L1 2H0V0H18ZM3.404 2L8 8.894V16H10V8.894L14.596 2H3.404Z"/>\n            </svg>\n            <span></span>\n        </div>\n        <div>\n            <svg viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/">\n                <g transform="matrix(1.20101,0,0,1.33333,-2.41206,-4)">\n                    <path d="M11.95,7.95L10.536,9.364L8,6.828L8,20L6,20L6,6.828L3.465,9.364L2.05,7.95L7,3L11.95,7.95Z"/>\n                </g>\n                <g transform="matrix(1.20101,0,0,1.33333,-2.41206,-4)">\n                    <path d="M21.95,16.05L17,21L12.05,16.05L13.464,14.636L16.001,17.172L16,4L18,4L18,17.172L20.536,14.636L21.95,16.05Z"/>\n                </g>\n            </svg>\n        </div>',t.textContent="Columns",s.innerHTML='<svg class="svg-icon" viewBox="0 0 20 20">\n\t\t\t\t\t\t\t<path fill="none" d="M12.323,2.398c-0.741-0.312-1.523-0.472-2.319-0.472c-2.394,0-4.544,1.423-5.476,3.625C3.907,7.013,3.896,8.629,4.49,10.102c0.528,1.304,1.494,2.333,2.72,2.99L5.467,17.33c-0.113,0.273,0.018,0.59,0.292,0.703c0.068,0.027,0.137,0.041,0.206,0.041c0.211,0,0.412-0.127,0.498-0.334l1.74-4.23c0.583,0.186,1.18,0.309,1.795,0.309c2.394,0,4.544-1.424,5.478-3.629C16.755,7.173,15.342,3.68,12.323,2.398z M14.488,9.77c-0.769,1.807-2.529,2.975-4.49,2.975c-0.651,0-1.291-0.131-1.897-0.387c-0.002-0.004-0.002-0.004-0.002-0.004c-0.003,0-0.003,0-0.003,0s0,0,0,0c-1.195-0.508-2.121-1.452-2.607-2.656c-0.489-1.205-0.477-2.53,0.03-3.727c0.764-1.805,2.525-2.969,4.487-2.969c0.651,0,1.292,0.129,1.898,0.386C14.374,4.438,15.533,7.3,14.488,9.77z"></path>\n\t\t\t\t\t\t</svg>',n.contentEditable="true",n.placeholder="search...",n.spellcheck="false",n.disabled=!0,s.addEventListener("click",(()=>{this.menu.search.classList.toggle("active"),this.menu.search.classList.contains("active")?(n.disabled=!1,n.focus()):n.disabled=!0})),n.addEventListener("focus",(()=>{console.log(this.menu.col),this.menu.wrapper.classList.contains("head")?this.tbody.querySelectorAll('[role="row"]').forEach((e=>e.children[this.menu.col].classList.add("search"))):this.tbody.classList.add("search")})),n.addEventListener("blur",(()=>{this.table.querySelectorAll(".search").forEach((e=>e.classList.remove("search")))})),n.addEventListener("click",(()=>{this.menu.search.classList.contains("active")||this.menu.search.classList.add("active")})),n.addEventListener("dblclick",(()=>{n.textContent&&selectText(n)})),n.addEventListener("input",(e=>{this.menu.wrapper.classList.contains("head")&&(e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"),this.searchTable(e.target.textContent)})),this.menu.search.append(s,n),t.appendChild(this.menu.colsDrop),this.menu.wrapper.append(this.menu.icons,this.menu.search,t),void 0!==e.task?(this.task=e.task,socket.send({f:2501,i:BopTable.tables.indexOf(this),t:this.task})):(this.rows=e.rows,this.cols=e.cols,this.options=e.options),this.table.append(this.thead,this.tbody),this.wrapper.append(this.header,this.table,this.footer,this.menu.wrapper)}colGrid(){const e=parseInt(window.getComputedStyle(document.getElementsByTagName("html")[0]).getPropertyValue("font-size").match(/\d+/)[0])??16;let t=this.cols.map((e=>e.width??"1fr")),s=0,n=this.table.getBoundingClientRect().width;if(1===t.filter((e=>"0fr"!==e)).length)for(const[e,s]of t.entries())"0fr"!==s&&(t[e]="1fr");else{for(let[i,a]of t.entries())if("rem"===a.slice(-3)){const s=e*parseFloat(a);t[i]=s+"px",n-=s}else"px"===a.slice(-2)?n-=parseFloat(a):"fr"===a.slice(-2)&&(s+=parseFloat(a));let i;if(s>0){const e=n/s;for(const[s,n]of t.entries())if("px"===n.slice(-2)){const a=parseFloat(n)/e;t[s]=a+"fr",a>0&&(i&&a<parseFloat(t[i])?i=s:i||(i=s))}else parseFloat(n)>0&&(i&&parseFloat(n)<parseFloat(t[i])?i=s:i||(i=s));const a=1/parseFloat(t[i]);for(let e of t)e=parseFloat(e)*a+"fr"}else{for(const[e,s]of t.entries())"px"===s.slice(-2)&&parseFloat(s)>0&&(i&&parseFloat(s)<parseFloat(t[i])?i=e:i||(i=e));const e=1/parseFloat(t[i]);for(const[s,n]of t.entries())"px"===n.slice(-2)&&(t[s]=parseFloat(n)*e+"fr")}}const i=t.join(" ");this.thead.style.gridTemplateColumns=i,this.tbody.style.gridTemplateColumns=i,this.cols.map((e=>e.head.classList.remove("last"))),this.cols.filter((e=>"0fr"!==e.width)).pop().head.classList.add("last")}destroy(){this.menu.observer?.disconnect(),this.wrapper.remove(),BopTable.tables.splice(BopTable.tables.indexOf(this),1),0===BopTable.tables.length&&document.removeEventListener("click",BopTable.menuListener)}static destroyAll(){for(const e of BopTable.tables)e.destroy()}dockMenu(){this.menuMove(),this.menu.wrapper.classList.remove("head"),this.menu.wrapper.style="",this.menu.colsDrop.style="";this.menu.search.getElementsByTagName("span")[0].style="",this.menu.observer?.disconnect(),delete this.menu.observer,delete this.menu.col}static find(e){for(const t of BopTable.tables)if(t.wrapper.contains(e)||t.wrapper===e)return t;return!1}findCol(e){for(const t of this.cols)if(t.head===e||t.head.contains(e))return t;return!1}headClick(e){const t=this.menu.wrapper;if(e.id===this.menu.col&&t.classList.contains("head"))return this.dockMenu();this.menuToHead(e.id),t.classList.add("head")}headOver(e){this.menu.wrapper.classList.contains("head")&&this.menu.col!==e.id&&this.headClick(e)}loadDown(e,t){let s=1,n=++e;const i=this.search.rows??this.rows;for(;s<t&&n<i.length;)this.loadRow(n++),s++;return console.log("+50"),--n}loadRow(key,top){const rowData=this.search.rows?this.search.rows[key]:this.rows[key];let row;if(Array.isArray(rowData)){row=document.createElement("div"),row.setAttribute("role","row"),row.id=`${BopTable.tables.indexOf(this)}.${key}`;for(const col of this.cols){let cell=document.createElement("div");if(cell.setAttribute("role","cell"),cell.style.gridColumn=col.id+1,Array.isArray(rowData[col.id])){let e=[];for(const t of rowData[col.id])e.push("number"==typeof t&&"string"==typeof col.options?this.options[col.options][t].name:t);cell.textContent=e.join(",")}else cell.textContent="number"==typeof rowData[col.id]&&"string"==typeof col.options?this.options[col.options][rowData[col.id]].name:rowData[col.id]??"";if("number"==typeof col.groupby&&(cell.width="0fr"),void 0!==col.action)for(const[key,value]of Object.entries(col.action))cell.addEventListener(key,eval(value));row.appendChild(cell)}if(this.search.string&&highlightSearch(this.search.col?row.children[this.search.col]:Array.from(row.children),this.search.string?.split(" ")),top){const e=document.getElementById(`${this.id}.${key+1}`);e.parentNode.insertBefore(row,e)}else this.scroll.last.appendChild(row)}else{this.scroll.groups.includes(rowData.col)||this.scroll.groups.push(rowData.col);const e=this.scroll.groups.indexOf(rowData.col);row=document.createElement("div");let t=this.tbody,s=document.createElement("button");row.setAttribute("role","presentation"),row.id=`${BopTable.tables.indexOf(this)}.${key}`;let n=document.createElement("div");if(e>0)for(let s=0;s<e;s++)t=t.lastElementChild;!rowData.name||"string"!=typeof this.cols[rowData.col].options||void 0!==this.cols[rowData.col].sortby&&0!==this.cols[rowData.col].sortby?s.textContent=rowData.name??"":s.textContent=this.options[this.cols[rowData.col].options][rowData.name].name,row.addEventListener("click",(e=>{e.currentTarget.nextElementSibling.classList.toggle("collapsed")})),row.appendChild(s),t.append(row,n),this.scroll.last=n}return row}loadUp(){}static menuListener(e){BopTable.tables.map((t=>{t.menu.wrapper.contains(e.target)||t.thead.contains(e.target)||!t.menu.wrapper.classList.contains("head")||t.dockMenu(),""===t.menu.search.getElementsByTagName("span")[0].textContent&&(t.menu.wrapper.classList.contains("head")&&!t.menu.search.contains(e.target)||!t.menu.wrapper.classList.contains("head")&&!t.menu.wrapper.contains(e.target))&&t.menu.search.classList.remove("active")}))}async menuMove(){this.timeout&&clearTimeout(this.timeout);const e=this.menu.wrapper.classList;e.add("move");this.timeout=setTimeout((()=>{e.remove("move")}),500)}menuToHead(e){this.menu.observer?.disconnect(),this.menuMove(),"number"==typeof e&&(this.menu.col=e);const t=this.cols[this.menu.col],s=this.menu.wrapper,n=s.offsetParent.getBoundingClientRect(),i=t.head.getBoundingClientRect();s.style.top=Math.floor(i.y+i.height-t.head.offsetTop-n.y)+"px",this.menu.wrapper.classList.add("head"),this.menu.icons.innerHTML=this.menu.colsDrop.children[t.id].children[1].innerHTML,this.menu.icons.children[0].addEventListener("click",(()=>{BopTable.find(s).toggleColVis(t)})),this.menu.icons.children[1].addEventListener("click",(()=>{BopTable.find(s).setGroupBy(t.id)})),this.menu.icons.children[2].addEventListener("click",(()=>{BopTable.find(s).setSortBy(t.id)})),this.menu.observer=new ResizeObserver((e=>{if(s.classList.contains("head"))for(const t of e){const e=t.target.getBoundingClientRect(),i=convertRemToPixels(7);let a,o=e.width>i?e.width:i;s.style.width=e.width>i?e.width+"px":"",s.getElementsByTagName("ul")[0].style.width=s.style.width;const r=(e.width-i)/2,l=e.width>i?e.x-n.x:e.x-n.x+r;a=l<0?e.x-n.x:l>n.width-o?n.width-o:l,s.style.left=Math.floor(a-1)+"px"}})),this.menu.observer.observe(this.cols[this.menu.col].head),document.activeElement===this.menu.search.getElementsByTagName("span")[0]&&(this.tbody.querySelectorAll(".search").forEach((e=>e.classList.remove("search"))),this.tbody.querySelectorAll('[role="row"]').forEach((e=>e.children[this.menu.col].classList.add("search"))))}multiplyRows(e){for(let t=0;t<e;t++)this.rows.push(this.rows[Math.floor(Math.random()*(Math.floor(37)-Math.ceil(0)+1))+Math.ceil(0)])}static parseData(e){let t=BopTable.tables[e.i];t.rows=e.response.rows;for(const[e,s]of t.rows.entries())for(const[n,i]of s.entries())t.rows[e][n]=i||"";t.cols=e.response.cols,t.options=e.response.options,t.populate()}populate(){if(0===this.thead.children.length){this.thead.innerHTML="",this.menu.colsDrop.innerHTML="",this.menu.colsDrop.addEventListener("pointerdown",(e=>{e.stopPropagation()}));for(const e of this.cols){void 0===e.width&&"number"==typeof e.groupby&&(e.width="0fr"),e.oriWidth=void 0===e.width||"0fr"==e.width?"1fr":e.width;let t=document.createElement("li"),s=document.createElement("button"),n=document.createElement("div");t.textContent=e.name,"0fr"===e.width?t.classList.add("shrunk"):t.classList.remove("shrunk"),n.innerHTML=this.menu.icons.innerHTML,n.addEventListener("click",(e=>{e.stopPropagation()})),e.visIcon=n.children[0],e.groupIcon=n.children[1],e.sortIcon=n.children[2],s.textContent="↕",s.addEventListener("click",(e=>{e.stopPropagation()})),t.append(s,n),t.addEventListener("click",(()=>{this.toggleColVis(e)})),e.visIcon.addEventListener("click",(()=>{BopTable.find(n).toggleColVis(e)})),e.groupIcon.addEventListener("click",(()=>{BopTable.find(n).setGroupBy(e.id)})),e.sortIcon.addEventListener("click",(()=>{BopTable.find(n).setSortBy(e.id)})),this.menu.colsDrop.appendChild(t);let i=document.createElement("div");if(i.setAttribute("role","columnheader"),e.head=i,i.textContent=e.name,i.addEventListener("click",(()=>{this.headClick(e)})),i.addEventListener("mouseover",(()=>{this.headOver(e)})),this.thead.appendChild(i),this.cols.indexOf(e)<this.cols.length-1){let t=document.createElement("div");t.addEventListener("pointerdown",(()=>{this.resizeCol(e)})),t.addEventListener("click",(e=>{e.stopPropagation()})),i.appendChild(t)}if("string"==typeof e.options&&"number"==typeof e.sortby&&1===e.sortby)for(const t of this.rows)Array.isArray(t[e.id])?t[e.id]=t[e.id].map((t=>this.options[e.options][t].name)):t[e.id]=this.options[e.options][t[e.id]]?.name??""}this.colGrid(),this.sort()}else{const e={root:this.tbody,rootMargin:"1000px 0px",threshold:0};const t=(e,t)=>{const s=this.search.rows??this.rows;s.length>0&&e.forEach((e=>{if(e.target===this.scroll.topRow.firstElementChild){if(e.isIntersecting){const e=parseInt(this.scroll.topRow.id.split(".")[1])-1;s[e]&&(this.scroll.rowObserver.unobserve(this.scroll.topRow.firstElementChild),this.scroll.topRow=document.getElementById(`${this.id}.${e}`)??this.loadRow(e,!0),this.scroll.rowObserver.observe(this.scroll.topRow.firstElementChild))}}else if(e.target===this.scroll.bottomRow?.firstElementChild){const t=parseInt(this.scroll.bottomRow.id.split(".")[1]);if(e.isIntersecting&&t<s.length-1){let e=this.loadDown(t,50);this.scroll.rowObserver.unobserve(this.scroll.bottomRow.firstElementChild),this.scroll.bottomRow=document.getElementById(`${this.id}.${e}`),this.scroll.rowObserver.observe(this.scroll.bottomRow.firstElementChild)}}}))};this.scroll.rowObserver=new IntersectionObserver(t,e);const s=performance.now();this.tbody.innerHTML="",delete this.scroll.topRow,delete this.scroll.bottomRow,this.scroll.last=this.tbody,this.scroll.groups=[];for(const[e,t]of this.search.rows?.entries()??this.rows.entries()){const t=this.loadRow(e);if(t){if(this.scroll.topRow){this.scroll.bottomRow=t,this.scroll.rowObserver.observe(t.firstElementChild);break}this.scroll.topRow=t,this.scroll.rowObserver.observe(t.firstElementChild)}}console.log(performance.now()-s+"ms draw")}}reset(){delete this.sorted,socket.send({f:2501,i:BopTable.tables.indexOf(this),t:this.task})}resizeCol(e){const t=this;let s;for(let t=e.id+1;t<this.cols.length;t++)if(this.cols[t].head.offsetWidth>0){s=t;break}const n=e.head.offsetWidth+this.cols[s].head.offsetWidth;this.table.classList.add("resize"),this.dockMenu();const i=i=>{const a=i.pageX-e.head.getBoundingClientRect().left,o=n-a;a>32&&o>32&&(t.cols[e.id].width=`${a}px`,t.cols[s].width=`${o}px`,t.colGrid())};document.addEventListener("pointermove",i),document.addEventListener("pointerup",(()=>{document.removeEventListener("pointermove",i),this.table.classList.remove("resize")}),{once:!0}),document.body.addEventListener("pointerleave",(()=>{document.removeEventListener("pointermove",i),this.table.classList.remove("resize")}),{once:!0})}searchTable(e,t){const s=performance.now();if(delete this.search.rows,delete this.search.string,delete this.search.col,e){let s;this.rows=this.rows.filter((e=>Array.isArray(e)&&!this.tempRows?.includes(e))),delete this.tempRows,this.search.string=e,this.search.col=t??this.menu.col??void 0;const n=e.split(" ").map((e=>normalizePlus(e))),i=e=>{for(let t=s.length-1;t>=0;t--)normalizePlus(e).includes(s[t])&&s.splice(t,1)},a=(e,t)=>{if(e)switch(typeof e){case"number":"string"==typeof this.cols[t].options?i(this.options[this.cols[t].options][`${e}`].name):i(`${e}`);break;case"object":"number"==typeof e[0]&&"string"==typeof this.cols[t].options?e.some((e=>i(this.options[this.cols[t].options][`${e}`].name))):e.some((e=>i(`${e}`)));break;default:i(e)}},o=(e,t)=>{s=[...n],t.map((t=>a(e[t],t)))};this.search.rows=this.rows.filter((e=>{const t=this.search.col?[this.search.col]:this.cols.map((e=>e.id));return o(e,t),!(s.length>0)}))}console.log(performance.now()-s+"ms search"),this.sort()}setGroupBy(e){const t=this.setGroups().map((e=>e[1]));if(t.includes(e)){const s=t.indexOf(e);s>0?(this.cols[e].groupby=s-1,this.cols[t[s-1]].groupby=s):(t.map(((e,t)=>this.cols[e].groupby=t-1)),delete this.cols[e].groupby)}else this.cols[e].groupby=t.length>0?this.cols[t[t.length-1]].groupby+1:0;void 0===this.cols[e].sorting&&(this.cols[e].sorting=0),this.sort()}setGroups(){let e=[];for(const t of this.cols)"number"==typeof t.groupby&&e.push({col:t.id,dir:t.sorting??0,id:t.groupby});return quicksort(e,[[0,"id"]]).map((e=>[e.dir,e.col]))}setSortBy(e){for(const t of this.cols)t.id===e?"number"==typeof t.groupby?t.sorting="number"==typeof t.sorting&&0===t.sorting?1:0:void 0===t.sorting?t.sorting=0:0===t.sorting?t.sorting=1:(delete t.sorting,this.cols[0].sorting=0):void 0===t.groupby&&"number"==typeof t.sorting&&delete t.sorting;this.sort()}sort(){let e=[0,0],t=[];for(const s of this.cols)s.sortIcon.className="","number"==typeof s.groupby?(t.push({col:s.id,dir:s.sorting??0,id:s.groupby}),s.groupIcon.className="on",s.groupIcon.lastElementChild.textContent=s.groupby,s.sortIcon.className="number"==typeof s.sorting&&1===s.sorting?"up":"down"):(s.groupIcon.className="",s.groupIcon.lastElementChild.textContent="","number"==typeof s.sorting&&(e=[s.sorting,s.id])),s.visIcon.className="string"==typeof s.width&&"0fr"===s.width?"hide":"show";this.cols[e[1]].sortIcon.className=1===e[0]?"up":"down","number"==typeof this.menu.col&&(this.menu.icons.children[0].className=this.cols[this.menu.col].visIcon.className,this.menu.icons.children[1].className=this.cols[this.menu.col].groupIcon.className,this.menu.icons.children[1].lastElementChild.textContent=this.cols[this.menu.col].groupIcon.lastElementChild.textContent,this.menu.icons.children[2].className=this.cols[this.menu.col].sortIcon.className),t=quicksort(t,[[0,"id"]]).map((e=>[e.dir,e.col]));let s=[...t,[e[0],e[1]]];0!==e[1]&&s.push([0,0]);(e=>{if(e=e.filter((e=>Array.isArray(e)&&!this.tempRows?.includes(e))),delete this.tempRows,e.length>0){if(void 0===this.sorted||s!==this.sorted){const n=t.filter((e=>this.cols[e[1]].multi));if(n.length>0){this.tempRows=[];for(const t of n)e.map((e=>{if(e[t[1]].length>1){let s=[],n=[...e[t[1]]];for(let i=1;i<e[t[1]].length;i++)n.splice(0,0,n.pop()),s.push([...e]),s[i-1][t[1]]=[...n];this.tempRows.push(...s)}}));e=[...e,...this.tempRows]}this.sorted=s,quicksort(e,s)}if(t.length>0){const s=e[0];let n,i=0,a={};for(const[o,r]of t.entries())e.splice(i,0,{col:r[1],name:Array.isArray(s[r[1]])?s[r[1]][0]:s[r[1]],start:i+1,value:s[r[1]]}),a[r[1]]={last:i++,value:Array.isArray(s[r[1]])?s[r[1]][0]:s[r[1]]},n=o;for(const[s,o]of e.entries())if(Array.isArray(o)){i=s;for(const[r,l]of t.entries()){const t=Array.isArray(o[l[1]])?o[l[1]][0]:o[l[1]];(n<r||t!==a[l[1]].value)&&(e[a[l[1]].last].end=s-1,e.splice(i,0,{col:l[1],name:Array.isArray(o[l[1]])?o[l[1]][0]:o[l[1]],start:i+1,value:o[l[1]]}),a[l[1]]={last:i++,value:t},n=r)}}}}this.search.rows?this.search.rows=e:this.rows=e,this.populate()})(this.search.rows??this.rows)}toggleColVis(e){e.width="string"==typeof e.width&&"0fr"===e.width?e.oriWidth:"0fr","0fr"===e.width?this.menu.colsDrop.children[e.id].classList.add("shrunk"):this.menu.colsDrop.children[e.id].classList.remove("shrunk"),this.cols.map((e=>{e.visIcon.className="string"==typeof e.width&&"0fr"===e.width?"hide":"show",e.id===this.menu.col&&(this.menu.icons.children[0].className=e.visIcon.className)})),this.colGrid()}}function buttonDown(e){e.classList.add("btn-down")}function buttonUp(e){e.classList.remove("btn-down")}function btnsActivate(){let e=document.getElementsByTagName("button");for(var t of e)t.addEventListener("mousedown",(function(){buttonDown(t),t.addEventListener("mouseup",(function(){buttonUp(t)}),{once:!0}),t.addEventListener("mouseout",(function(){buttonUp(t),t.removeEventListener("mousedown",(function(){buttonDown(t),t.addEventListener("mouseup",(function(){buttonUp(t)}),{once:!0})}))}),{once:!0})}))}async function fetchPost(e){let t=await fetch("/",{method:"POST",headers:{"Content-Type":'application/x-www-form-urlencoded; charset="utf-8"'},body:e});return t.ok?"ok":(alert("HTTP-Error: "+t.status),"error")}async function fetchPostText(e){let t=await fetch("/",{method:"POST",headers:{"Content-Type":'application/x-www-form-urlencoded; charset="utf-8"'},body:e});if(t.ok){return await t.text()}return alert("HTTP-Error: "+t.status)}async function fetchPostJSON(e,t=!1){const s=t?"application/json":'application/x-www-form-urlencoded; charset="utf-8"';let n;return n=await fetch("/",{method:"POST",headers:{"Content-Type":s,Accept:"application/json"},body:e}).then((e=>e.json())).then((e=>{if(e.error)throw e;return e.success&&sweetAlert({content:e.success,type:"success"}),e})).catch((e=>{console.error(e.error),e.data&&console.debug(e.data),sweetAlert({content:e.fail,type:"danger"})})),n}btnsActivate();class Field{static fields=[];static timer;constructor(e){this.wrapper=document.createElement("div"),this.input=[],this.isValid=!1,this.timer,this.add=e.add??void 0,this.modal=e.modal??!1,this.multi=e.multi,this.name=e.name,this.task=e.task??void 0,this.type=e.type,this.required=e.required??!1,this.wrapper.style.gridArea=e.grid??null,"boolean"==typeof e.compact&&e.compact&&this.wrapper.classList.add("compact"),this.wrapper.classList.add("field"),this.wrapper.setAttribute("aria-label",this.name);const t=e.placeholder??"",s=e.label??this.name;switch(this.type){case"address":{this.wrapper,this.fields=[];let t=document.createElement("input"),s=document.createElement("input"),n=document.createElement("input"),i=document.createElement("input");this.wrapper.setAttribute("aria-label","Addresse"),setElementAttributes(t,[["placeholder","2 rue du Port"],["name","Numéro et voie"]]),setElementAttributes(s,[["placeholder","87200"],["name","Code postal"]]),setElementAttributes(n,[["placeholder","Sainte Bernadette"],["name","Ville"]]),setElementAttributes(i,[["placeholder","France"],["name","Pays"]]),e.value&&(t.value=e.value.street,s.value=e.value.postcode,n.value=e.value.city,i.value=e.value.country),this.wrapper.append(t,s,n,i),this.input.push([t,s,n,i]);break}case"email":{let s=document.createElement("input");setElementAttributes(s,[["type","email"],["pattern","^[\\w!#$%&’*+/=?`{|}~^-]+(?:\\.[\\w!#$%&’*+/=?`{|}~^-]+)*@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,6}$"],["placeholder",t]]),this.wrapper.append(s),s.value=e.value??"",s.addEventListener("input",(function(){const e=Field.find(s);e.getValid(),e.modal&&Modal.find(s)?.checkRequiredFields()})),this.input.push(s);break}case"input_string":{let s=document.createElement("input");if(setElementAttributes(s,[["spellcheck","false"],["autocomplete","off"],["placeholder",t]]),this.wrapper.append(s),e.value&&(s.value=e.value),this.required){const e=this;s.addEventListener("input",(()=>{e.getValid(),Modal.find(s)?.checkRequiredFields()}))}this.input.push(s);break}case"input_text":{let s=document.createElement("textarea");if(setElementAttributes(s,[["placeholder",t]]),this.wrapper.append(s),s.textContent=e.value??"",this.required){const e=this;s.addEventListener("input",(()=>{e.getValid(),Modal.find(s)?.checkRequiredFields()}))}this.input.push(s);break}case"password":case"current-password":case"new-password":{let e=document.createElement("input");e.className="password",setElementAttributes(e,[["type","password"],["pattern","^(?=.*[a-z])(?=.*[A-Z])(?=.*[\\d])(?=.*[!@#$%^&*]).{12,}$"],["maxlength","64"],["placeholder",t],["autocomplete","password"!==this.type?this.type:""]]),this.wrapper.append(e),this.wrapper.insertAdjacentHTML("beforeend",'<svg viewBox="0 0 24 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" tabindex="0">\n                        <g>\n                        <path d="M17.882,18.297C16.123,19.413 14.083,20.003 12,20C6.608,20 2.122,16.12 1.181,11C1.611,8.671 2.783,6.543 4.521,4.934L1.392,1.808L2.807,0.393L22.606,20.193L21.191,21.607L17.882,18.297ZM5.935,6.35C4.576,7.586 3.629,9.209 3.223,11C3.535,12.367 4.162,13.641 5.054,14.723C5.946,15.804 7.078,16.663 8.36,17.229C9.641,17.796 11.038,18.056 12.438,17.988C13.838,17.92 15.203,17.526 16.424,16.838L14.396,14.81C13.533,15.354 12.51,15.588 11.496,15.475C10.482,15.361 9.537,14.906 8.816,14.185C8.094,13.463 7.639,12.518 7.526,11.504C7.412,10.49 7.646,9.467 8.19,8.604L5.935,6.35ZM12.914,13.328L9.672,10.086C9.494,10.539 9.452,11.034 9.552,11.51C9.651,11.987 9.887,12.424 10.231,12.768C10.575,13.112 11.012,13.348 11.489,13.448C11.965,13.547 12.46,13.505 12.913,13.327L12.914,13.328ZM20.807,15.592L19.376,14.162C20.045,13.209 20.52,12.135 20.777,11C20.505,9.81 19.994,8.687 19.275,7.701C18.556,6.714 17.644,5.884 16.594,5.261C15.544,4.638 14.378,4.234 13.168,4.076C11.957,3.917 10.727,4.006 9.552,4.338L7.974,2.76C9.221,2.27 10.58,2 12,2C17.392,2 21.878,5.88 22.819,11C22.513,12.666 21.824,14.238 20.807,15.592ZM11.723,6.508C12.36,6.469 12.997,6.565 13.594,6.791C14.19,7.017 14.732,7.367 15.182,7.818C15.634,8.268 15.983,8.81 16.209,9.407C16.435,10.003 16.531,10.641 16.492,11.277L11.723,6.508Z"></path>\n                        <g transform="matrix(1,0,0,1,12.008,10.9872)">\n                            <g transform="matrix(1,0,0,1,-11,-9)">\n                            <path class="hide" d="M11,0C16.392,0 20.878,3.88 21.819,9C20.879,14.12 16.392,18 11,18C5.608,18 1.122,14.12 0.181,9C1.121,3.88 5.608,0 11,0ZM11,16C13.04,16 15.018,15.307 16.613,14.035C18.207,12.764 19.323,10.988 19.777,9C19.321,7.013 18.205,5.24 16.611,3.97C15.016,2.7 13.038,2.009 11,2.009C8.962,2.009 6.984,2.7 5.389,3.97C3.795,5.24 2.679,7.013 2.223,9C2.677,10.988 3.793,12.764 5.387,14.035C6.982,15.307 8.961,16 11,16ZM11,13.5C9.807,13.5 8.662,13.026 7.818,12.182C6.974,11.338 6.5,10.194 6.5,9C6.5,7.807 6.974,6.662 7.818,5.818C8.662,4.974 9.807,4.5 11,4.5C12.194,4.5 13.338,4.974 14.182,5.818C15.026,6.662 15.5,7.807 15.5,9C15.5,10.194 15.026,11.338 14.182,12.182C13.338,13.026 12.194,13.5 11,13.5ZM11,11.5C11.663,11.5 12.299,11.237 12.768,10.768C13.237,10.299 13.5,9.663 13.5,9C13.5,8.337 13.237,7.701 12.768,7.232C12.299,6.763 11.663,6.5 11,6.5C10.337,6.5 9.701,6.763 9.232,7.232C8.763,7.701 8.5,8.337 8.5,9C8.5,9.663 8.763,10.299 9.232,10.768C9.701,11.237 10.337,11.5 11,11.5Z">\n                            </path>\n                            </g>\n                        </g>\n                        </g>\n                    </svg>');const s=this.wrapper.getElementsByTagName("svg")[0];s.addEventListener("click",(e=>togglePw(e.currentTarget.parentNode))),s.addEventListener("keydown",(e=>{"Space"!==e.code&&"Enter"!==e.code||togglePw(e.currentTarget.parentNode)})),"new-password"===this.type&&e.addEventListener("input",(function(){const t=Field.find(e);t.getValid(),t.modal&&Modal.find(e)?.checkRequiredFields()})),this.input.push(e);break}case"phone":{let e=document.createElement("input");setElementAttributes(e,[["name",s],["placeholder",t]]),this.wrapper.append(e),this.intlTel=intlTelInput(e,{utilsScript:"./assets/intlTelInput/js/utils.js",initialCountry:"fr",preferredCountries:["fr"],onlyCountries:["be","ch","de","es","fr","gb","it"],localizedCountries:{de:"Deutschland",ch:"Schweiz",it:"Italia",es:"España"}}),e.addEventListener("input",(function(){e.removeAttribute("data-phone");const t=Field.find(e);t.getValid(),t.modal&&Modal.find(e)?.checkRequiredFields()})),this.input.push(e);break}case"quill":{let e=document.createElement("div");const s={debug:"log",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},placeholder:t||"Votre texte...",theme:"bubble"};this.wrapper.append(e),this.quill=new Quill(e,s);break}case"select":{let s=document.createElement("div"),n=document.createElement("input");this.ul=document.createElement("ul"),this.ul.className="fadeout",socket.send({f:7,s:this.task}),this.ul.setAttribute("role","listbox"),setElementAttributes(n,[["readonly","true"],["data-value",e.value],["placeholder",t]]),this.wrapper.classList.add("select"),s.className="container",s.append(n,this.ul),this.wrapper.append(s),n.addEventListener("click",(()=>{this.ul.classList.toggle("fadeout")})),this.input.push(n);break}case"selectize":{const s=this;let n=document.createElement("div"),i=document.createElement("button"),a=document.createElement("input");if(this.selected={wrapper:document.createElement("div"),items:[]},this.ul=document.createElement("ul"),this.ul.setAttribute("role","listbox"),setElementAttributes(a,[["spellcheck","false"],["autocomplete","off"],["placeholder",t]]),this.wrapper.classList.add("selectize"),n.className="container",n.append(a,this.ul),this.selected.wrapper.className="selected",e.add&&(i.textContent="+",n.append(i),i.addEventListener("click",(function(t){let n=[];for(const e of s.selected.wrapper.children)n.push(e.textContent);n.includes(a.value)||e.add(a)}))),e.value)for(const[t,s]of e.value.entries()){let e=document.createElement("span");s.content?e.textContent=s.group?`${s.content} (${s.group})`:s.content:e.textContent=s.group,e.setAttribute("tabindex","0"),e.addEventListener("click",(()=>{console.log(this.selected),this.selected.items.splice(this.selected.items[t],1),e.remove()})),this.selected.items.push({id:s["data-select"],content:s.content,element:e,email:s.email??void 0,group:s.group??void 0}),this.selected.wrapper.append(e)}this.wrapper.append(n,this.selected.wrapper),a.addEventListener("input",(()=>{s.fetchDataTimer()})),a.addEventListener("keydown",(t=>{switch(t.code){case"ArrowDown":t.preventDefault(),s.ul.getElementsByTagName("li").length>0?s.ul.getElementsByTagName("li")[0].focus():s.wrapper.nextElementSibling?.getElementsByTagName("input")[0]?s.wrapper.nextElementSibling.getElementsByTagName("input")[0].focus():s.wrapper.nextElementSibling?.getElementsByTagName("textarea")[0]&&s.wrapper.nextElementSibling.getElementsByTagName("textarea")[0].focus();break;case"ArrowUp":t.preventDefault(),s.wrapper.previousElementSibling?.getElementsByTagName("input")[0]?s.wrapper.previousElementSibling.getElementsByTagName("input")[0].focus():s.wrapper.previousElementSibling?.getElementsByTagName("textarea")[0]&&s.wrapper.previousElementSibling.getElementsByTagName("textarea")[0].focus();break;case"Escape":a.blur();break;case"Enter":if(e.add&&Modal.find(s.wrapper)?.hasRoom()){let t=[];for(const e of s.selected.wrapper.children)t.push(e.textContent);t.includes(a.value)||(fadeOut(s.ul,{hide:!0}),e.add(a))}}})),a.addEventListener("focus",(()=>{if(a.value.split(" ").length<5){Field.find(a).fetchDataTimer()}})),this.input.push(a);break}case"boptable":{let t=document.createElement("div");this.wrapper.append(t),e.options.caption=this.name,e.options.wrapper=t,new BopTable(e.options);break}}this.required&&this.getValid(),Field.fields.push(this)}async addSelectize(e,t){const s=this,n=Modal.find(this.wrapper);let i=document.createElement("span"),a={id:e,element:i};i.textContent=t,i.setAttribute("tabindex","0"),this.multi||(removeChildren(this.selected.wrapper,!0),this.selected.items=[]),this.selected.items.push(a),this.selected.wrapper.append(i),i.addEventListener("click",(()=>{s.selected.items.splice(s.selected.items.indexOf(a),1),i.remove(),s.isValid=s.selected.items.length>0,n?.checkRequiredFields()})),i.addEventListener("keydown",(e=>{"Space"!==e.code&&"Enter"!==e.code||(s.selected.items.splice(s.selected.items.indexOf(a),1),i.remove(),s.isValid=s.selected.items.length>0,n?.checkRequiredFields())})),this.input[0].value="",removeChildren(this.ul,!0),setTimeout((()=>{s.input[0].focus()}),50),this.isValid=!0,n?.checkRequiredFields()}destroy(){Field.fields.splice(Field.fields.indexOf(this),1),"table"===this.type&&tabuDestroy(this.wrapper),this.wrapper.remove()}fetchData(){console.log(Field.fields),socket.send({f:7,s:this.task,i:this.input[0].value,x:Field.fields.indexOf(this)})}fetchDataTimer(){clearTimeout(this.timer),void 0!==this.task&&(this.input[0].value?this.timer=setTimeout((()=>{this.fetchData()}),50):(clearTimeout(this.timer),removeChildren(this.ul,!0)))}static find(e){if(void 0===e.parentElement){let t=[];for(const s of Field.fields){let n;for(const[t,i]of Object.entries(e))n=s[t]===i;n&&t.push(s)}return t}for(const t of Field.fields)if(t.wrapper===e||t.wrapper.contains(e)||t.input.includes(e))return t}getValid(){const e=this.input[0];switch(this.type){case"email":case"password":case"current-password":case"new-password":this.input[0].value?this.input[0].validity.valid?(this.isValid=!0,e.classList.add("valid"),e.classList.remove("invalid"),this.wrapper.setAttribute("aria-label",this.name)):(this.isValid=!1,e.classList.add("invalid"),e.classList.remove("valid"),this.wrapper.setAttribute("aria-label",this.name+" (invalide)")):(this.isValid=!1,e.classList.remove("invalid","valid"),this.wrapper.setAttribute("aria-label",this.name));break;case"input_string":case"input_text":this.isValid=!!this.input[0].value;break;case"phone":this.input[0].value?this.intlTel.isValidNumber()?(this.isValid=!0,this.phone=this.intlTel.getNumber(),e.classList.add("valid"),e.classList.remove("invalid"),this.wrapper.setAttribute("aria-label",this.name)):(this.isValid=!1,this.phone=void 0,e.classList.add("invalid"),e.classList.remove("valid"),this.wrapper.setAttribute("aria-label",this.name+" (invalide)")):(this.isValid=!1,this.phone=void 0,e.classList.remove("invalid","valid"),this.wrapper.setAttribute("aria-label",this.name));break;case"selectize":this.isValid=this.selected.length>0}}static parseData(e){if(7===e.f){if(e.i){const t=Field.fields[e.x],s=t.input[0],n=t.ul;if(e.response[0]?.fail)msg.new({content:e.response[0].fail,btn0listener:()=>s.focus()}),s.value=s.value.trim();else if(e.response[0]?.content){let i=[];for(const a of t.selected.items)i.push(a.id);removeChildren(n,!0);for(const o of e.response)if(null!==o.id&&!i.includes(`${o.id}`)){let r=document.createElement("li"),l=document.createElement("span");if(r.setAttribute("data-select",o.id),r.setAttribute("tabindex","0"),l.textContent=o.content,r.append(l),o.secondary){let c=document.createElement("span");c.textContent=`(${o.secondary})`,r.append(c)}if(o.role){const d=o.role.split(",");for(const h of d){let p=document.createElement("button");p.textContent=h,p.disabled=!0,r.append(p)}}if(o.email){r.setAttribute("data-email",o.email);let u=document.createElement("span");u.textContent=`(${o.email})`,l.insertAdjacentElement("afterend",u)}(o.status&&1===o.status||o.inchat&&1===o.inchat)&&r.classList.add("offline"),n.append(r)}highlightSearch(Array.from(n.getElementsByTagName("span")),s.value.split(" "));for(const m of n.children)m.addEventListener("keydown",(e=>t.selectizeKeysNav(e))),m.addEventListener("click",(e=>{let s=[];Array.from(e.currentTarget.getElementsByTagName("span")).map((e=>s.push(e.textContent))),t.addSelectize(e.currentTarget.getAttribute("data-select"),s.join(" "))}))}else removeChildren(n,!0)}else if(e.response[0]?.content){let f=Field.find({type:"select",task:e.s});for(let g of f){const v=g.input[0].getAttribute("data-value")??"",b=g.ul;function w(e){g.input[0].value=e.getElementsByTagName("span")[0].textContent;for(let t of e.parentNode.children)t.className=t===e?"selected":"";g.selected=e.getAttribute("data-select"),fadeOut(b)}removeAttributes(g.input[0],["data-value","data-f","data-s"]);for(const y of e.response){let C=document.createElement("li"),L=document.createElement("span");setElementAttributes(C,[["data-select",y.id],["tabindex","0"]]),L.textContent=y.content,v&&v===y.id&&(g.input[0].value=y.content,C.className="selected"),C.append(L),C.addEventListener("click",(function(){w(C)})),C.addEventListener("keydown",(e=>{switch(e.code){case"Enter":case"Space":w(C);break;case"ArrowUp":e.preventDefault(),C!==b.firstChild&&C.previousElementSibling.focus();break;case"ArrowDown":e.preventDefault(),C!==b.lastChild&&C.nextElementSibling.focus()}})),b.append(C)}if(!g.input[0].value){const E=b.getElementsByTagName("li")[0];E.className="selected",g.selected=E.getAttribute("data-select"),g.input[0].value=E.getElementsByTagName("span")[0].textContent}}}}else 12===e.f&&e.response.id&&Field.fields[e.x].addSelectize(e.response.id,e.t)}selectizeKeysNav(e){const t=e.currentTarget;switch(e.code){case"ArrowUp":e.preventDefault(),t.previousSibling?t.previousSibling.focus():this.input[0].focus();break;case"ArrowDown":e.preventDefault(),t.nextSibling?.focus();break;case"Enter":case"Space":let s=[];Array.from(t.getElementsByTagName("span")).map((e=>s.push(e.textContent))),this.addSelectize(t.getAttribute("data-select"),s.join(" "));break;case"Escape":e.preventDefault(),fadeOut(this.ul),this.input[0].blur()}}static updateFields(){for(const e of Field.fields)void 0===e.wrapper&&Field.fields.splice(Field.fields.indexOf(e),1)}}var elem=document.documentElement;function openFullscreen(){elem.requestFullscreen?elem.requestFullscreen():elem.webkitRequestFullscreen?elem.webkitRequestFullscreen():elem.msRequestFullscreen&&elem.msRequestFullscreen()}function closeFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function toggleFullscreen(){document.webkitFullscreenElement||document.msFullscreenElement||document.fullscreenElement?closeFullscreen():openFullscreen()}class ClassLogin{constructor(){this.wrapper=document.getElementsByClassName("login")[0],this.btnController,this.timeout,this.email,this.currentPassword,this.newPassword,this.checkPassword}blankBox(){delete this.currentPassword,delete this.newPassword,delete this.checkPassword,delete this.phone,this.confirmationText?.remove(),delete this.confirmationText;let e=Array.from(this.box.children);for(let t=e.length-1;t>e.indexOf(this.email.wrapper);t--)e[t].remove();this.email.input[0].focus()}async checkMail(){if(this.email.input[0].value&&this.email.input[0].validity.valid){let e=await fetchPostText("f=3&a="+encodeURIComponent(this.email.input[0].value));"1"===e&&void 0===this.currentPassword?(this.blankBox(),this.loadCurrentPW()):"0"===e&&void 0===this.newPassword&&(this.blankBox(),this.loadNewPW())}else this.blankBox()}checkPWCheck(){this.checkPassword.input[0].value?this.checkPassword.input[0].value===this.newPassword.input[0].value?(this.commentDiff.classList.remove("up"),this.removeCheckPW(),this.loadPhone(),this.phone.input[0].focus()):(this.checkPassword.input[0].classList.add("invalid"),this.commentDiff.classList.add("up")):(this.checkPassword.input[0].classList.remove("invalid"),this.commentDiff.classList.remove("up"))}destroy(){}forgottenPW(){}load(){loadIn(this.wrapper),this.wrapper.innerHTML='<div class="login-header">\n            <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">\n                <defs>\n                    <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z">\n                    </path>\n                </defs>\n                <g class="parallax">\n                    <use href="#gentle-wave" x="48" y="0">\n                    </use>\n                    <use href="#gentle-wave" x="48" y="3">\n                    </use>\n                    <use href="#gentle-wave" x="48" y="5">\n                    </use>\n                    <use href="#gentle-wave" x="48" y="7">\n                    </use>\n                </g>\n            </svg>\n            <div class="login-modal">\n                <div class="login-box">\n                    <span class="login-title">\n                    SeaDesk\n                    </span>\n                </div>\n                <div class="login-box-buddy"></div>\n            </div>\n            <div class="login-footer">\n                <span>2021 © SeaDesk | bopdev <span class="fullscreen">[ ]</span></span>\n            </div>\n        </div>',this.box=this.wrapper.getElementsByClassName("login-box")[0],this.head=this.wrapper.getElementsByClassName("login-header")[0];const e=this.wrapper.getElementsByClassName("fullscreen")[0];this.email=new Field({compact:!0,name:"Email",placeholder:"Addresse email",required:!0,type:"email"}),this.email.wrapper.classList.add("login-content"),this.email.input[0].addEventListener("input",(()=>{login.timer()})),this.email.input[0].addEventListener("focus",(()=>{login.checkMail()})),this.box.appendChild(this.email.wrapper),this.head.addEventListener("click",(e=>{e.target===this.box||this.box.contains(e.target)||themify()})),e.addEventListener("click",toggleFullscreen),loadOut(this.wrapper)}loadCheckPW(){this.checkPassword=new Field({compact:!0,name:"Vérification mot de passe",placeholder:"Vérification mot de passe",type:"password"}),this.checkPassword.wrapper.classList.add("login-content"),this.checkPassword.wrapper.classList.add("invalid"),this.checkPassword.input[0].addEventListener("input",(()=>{login.checkPWCheck()})),this.box.appendChild(this.checkPassword.wrapper),this.box.insertAdjacentHTML("beforeend",'<div class="login-check pw-diff">\n                <span>Les champs de mot de passe sont différents.</span>\n            </div>'),this.commentDiff=this.box.getElementsByClassName("pw-diff")[0]}loadCurrentPW(){this.currentPassword=new Field({compact:!0,name:"Mot de passe",placeholder:"Mot de passe",type:"current-password"}),this.currentPassword.wrapper.classList.add("login-content"),this.currentPassword.input[0].addEventListener("input",(e=>{login.connectBtn.disabled=!e.target.value})),this.currentPassword.input[0].addEventListener("keydown",(e=>{"Enter"===e.code&&ClassLogin.openWS()})),this.connectBtn=document.createElement("button"),this.connectBtn.textContent="se connecter",this.connectBtn.className="theme",this.connectBtn.disabled=!0,this.connectBtn.addEventListener("click",ClassLogin.openWS),this.box.append(this.currentPassword.wrapper,this.connectBtn)}loadNewPW(){this.newPassword=new Field({compact:!0,name:"Nouveau mot de passe",placeholder:"Nouveau mot de passe",type:"new-password"}),this.newPassword.wrapper.classList.add("login-content"),this.box.appendChild(this.newPassword.wrapper),this.box.insertAdjacentHTML("beforeend",'<div class="login-check pw-list">\n                <span>Le mot de passe doit contenir :</span>\n                <ul>\n                    <li>au moins une lettre minuscule</li>\n                    <li>au moins une lettre majuscule</li>\n                    <li>au moins un chiffre</li>\n                    <li>au moins un caractère spécial parmi !@#$%^&*</li>\n                    <li>au moins 12 caractères</li>\n                    <li>au maximum 64 caractères</li>\n                </ul>\n            </div>'),this.commentList=this.box.getElementsByClassName("pw-list")[0],this.newPassword.input[0].addEventListener("input",(()=>{this.newPWCheck(),this.newPassword.input[0].value&&this.newPassword.input[0].validity.valid&&void 0===this.checkPassword?this.loadCheckPW():this.newPassword.input[0].validity.valid&&this.newPassword.input[0].value||this.removeCheckPW(),this.removePhone()})),this.newPassword.input[0].addEventListener("focus",(()=>{login.newPWFocus()}))}loadPhone(){this.phone=new Field({compact:!0,name:"Numéro de téléphone",type:"phone"}),this.phone.wrapper.classList.add("login-content"),this.box.appendChild(this.phone.wrapper),this.box.insertAdjacentHTML("beforeend",'<button class="theme" disabled>\n                Valider\n            </button>\n            <div class="login-check phone-msg">\n                <span>Le numéro de téléphone fourni n\'est pas valide.</span>\n            </div>'),this.validBtn=this.box.getElementsByTagName("button")[0],this.validBtn.addEventListener("click",(()=>{login.showConfirmation()}),{once:!0}),this.commentPhone=this.box.getElementsByClassName("phone-msg")[0],this.phone.input[0].addEventListener("input",(()=>{login.phoneCheck()})),this.phone.input[0].addEventListener("keydown",(e=>{"Enter"===e.code&&login.phone.intlTel.isValidNumber()&&login.showConfirmation()}))}newPWCheck(){const e=this.newPassword.input[0].value,t=this.commentList.getElementsByTagName("span")[0],s=this.commentList.getElementsByTagName("li");let n=0;/[a-z]+/.test(e)?fadeOut(s[0]):(fadeIn(s[0]),n=1),/[A-Z]+/.test(e)?fadeOut(s[1]):(fadeIn(s[1]),n=1),/[0-9]+/.test(e)?fadeOut(s[2]):(fadeIn(s[2]),n=1),/[!@#$%^&*]+/.test(e)?fadeOut(s[3]):(fadeIn(s[3]),n=1),e.length>11?fadeOut(s[4]):(fadeIn(s[4]),n=1),64===e.length?(fadeIn(s[5]),n=1):fadeOut(s[5]),0===n?fadeOut(t):fadeIn(t)}newPWFocus(){const e=this.newPassword.input[0];e.validity.valid&&e.value||this.commentList.classList.add("up"),e.addEventListener("blur",(()=>{login.newPassword.input[0].value||login.commentList.classList.remove("up")}),{once:!0})}static openWS(){login.currentPassword.input[0].blur(),socket?.close();let e=("localhost"===window.location.hostname?"ws://":"wss://")+window.location.host;socket=new WSConnection(e)}phoneCheck(){this.phone.input[0].value&&(this.phone.intlTel.isValidNumber()?(this.commentPhone.classList.remove("up"),this.validBtn.disabled=!1):(this.commentPhone.classList.add("up"),this.validBtn.disabled=!0))}async register(){const e=encodeURIComponent(this.email.input[0].value.trim()),t=encodeURIComponent(this.newPassword.input[0].value),s="f=4&email="+e+"&phone="+encodeURIComponent(this.phone.intlTel.getNumber())+"&password="+t;let n=await fetchPostText(s);console.log(n),"1"===n?(console.log("res = 1"),msg.new({content:"Votre compte a été créé ! Vous devriez recevoir sous peu un email ainsi qu'un sms nécéssaires à la validation de votre compte. En cas de difficulté, n'hésitez pas à contacter l'assistance.",type:"success",btn0listener:()=>{login.blankBox()}})):"0"===n&&(console.log("res = 0"),msg.new({content:"La création du compte a échouée, veuillez réessayer ultérieurement.",type:"warning"}))}removeCheckPW(){this.checkPassword?.destroy(),delete this.checkPassword,this.commentDiff?.remove(),delete this.commentDiff}removePhone(){this.confirmationText?.remove(),delete this.confirmationText,this.phone?.destroy(),delete this.phone,this.commentPhone?.remove(),delete this.commentPhone,this.validBtn?.remove(),delete this.validBtn}showConfirmation(){this.confirmationText=document.createElement("span"),this.confirmationText.textContent="Merci de bien vérifier les informations fournies, adresse email et numéro de téléphone portable doivent être valides et accessibles car ils seront utilisés pour finaliser la création de votre compte.",this.box.insertBefore(this.confirmationText,this.email.wrapper),this.validBtn.textContent="créer le compte",this.validBtn.addEventListener("click",(()=>{login.register()}))}timer(){clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.checkMail()}),70)}}let login=new ClassLogin,socket,main;class ClassMain{static el;constructor(e){ClassMain.el=this,main=this.wrapper,this.user={attempts:e.attempts_total,name:e.name,options:e.options},this.wrapper=document.getElementsByTagName("main")[0],this.chat=new BopChat(document.getElementById("chat"),e.chat),this.tabs={active:e.active_tab??1,data:e.tabs,item:[],map:e.tabs_map},this.navbar={ul:document.createElement("ul"),wrapper:document.getElementsByClassName("navbar")[0]};const t=localStorage.getItem("navbarClass");this.navbar.wrapper.className="navbar "+(null!==t?t:"left"),(null===t||t.split(" ").length<2)&&this.navbar.wrapper.setAttribute("style",localStorage.getItem("navbarStyle")??""),this.topbar={react:document.createElement("ul"),static:document.createElement("ul"),wrapper:document.getElementsByClassName("topbar")[0]},this.topbar.static.innerHTML="<li>\n            New\n            <ul>\n                <li>Email</li>\n                <li>Ticket</li>\n                <li>Contact</li>\n                <li>Company</li>\n            </ul>\n            </li>\n            <li>\n            Search\n            </li>",this.topbar.wrapper.append(this.topbar.react,this.topbar.static),this.topbar.static.querySelector("ul:first-of-type li:first-of-type").addEventListener("click",(()=>loadNewEmail())),this.topbar.static.querySelector("ul:first-of-type li:nth-of-type(2)").addEventListener("click",(()=>loadNewTicket())),this.topbar.static.querySelector("ul:first-of-type li:nth-of-type(3)").addEventListener("click",(()=>loadNewContact())),this.topbar.static.querySelector("ul:first-of-type li:nth-of-type(4)").addEventListener("click",(()=>loadNewCompany())),loadIn([this.wrapper,this.navbar.wrapper,this.topbar.wrapper,this.chat.wrapper]),this.navbar.wrapper.insertAdjacentHTML("beforeend",'<div class="nav-logo-back"></div>\n            <div class="nav-logo">\n                <span class="nav-title">s</span>\n                <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">\n                    <defs>\n                        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z">\n                        </path>\n                    </defs>\n                    <g class="parallax">\n                        <use href="#gentle-wave" x="48" y="0">\n                        </use>\n                        <use href="#gentle-wave" x="48" y="3">\n                        </use>\n                        <use href="#gentle-wave" x="48" y="5">\n                        </use>\n                        <use href="#gentle-wave" x="48" y="7">\n                        </use>\n                    </g>\n                </svg>\n            </div>'),this.navbar.wrapper.insertBefore(this.navbar.ul,this.navbar.wrapper.children[1]),setElementDraggable(this.navbar.wrapper,{constrain:!0,magnet:!0}),this.navbar.wrapper.getElementsByClassName("nav-logo")[0].addEventListener("pointerdown",(e=>{e.stopPropagation()})),this.navbar.ul.addEventListener("pointerdown",(e=>{e.stopPropagation()})),this.navbar.wrapper.addEventListener("pointerup",(()=>{this.navbarRelease()})),this.prepareTab(this.tabs.map);let s=document.createElement("li"),n=document.createElement("span"),i=document.createElement("li"),a=document.createElement("span");n.textContent="theme",s.appendChild(n),s.insertAdjacentHTML("beforeend",'<svg viewBox="0 0 20 20">\n              <path d="M5.114,5.726c0.169,0.168,0.442,0.168,0.611,0c0.168-0.169,0.168-0.442,0-0.61L3.893,3.282c-0.168-0.168-0.442-0.168-0.61,0c-0.169,0.169-0.169,0.442,0,0.611L5.114,5.726z M3.955,10c0-0.239-0.193-0.432-0.432-0.432H0.932C0.693,9.568,0.5,9.761,0.5,10s0.193,0.432,0.432,0.432h2.591C3.761,10.432,3.955,10.239,3.955,10 M10,3.955c0.238,0,0.432-0.193,0.432-0.432v-2.59C10.432,0.693,10.238,0.5,10,0.5S9.568,0.693,9.568,0.932v2.59C9.568,3.762,9.762,3.955,10,3.955 M14.886,5.726l1.832-1.833c0.169-0.168,0.169-0.442,0-0.611c-0.169-0.168-0.442-0.168-0.61,0l-1.833,1.833c-0.169,0.168-0.169,0.441,0,0.61C14.443,5.894,14.717,5.894,14.886,5.726 M5.114,14.274l-1.832,1.833c-0.169,0.168-0.169,0.441,0,0.61c0.168,0.169,0.442,0.169,0.61,0l1.833-1.832c0.168-0.169,0.168-0.442,0-0.611C5.557,14.106,5.283,14.106,5.114,14.274 M19.068,9.568h-2.591c-0.238,0-0.433,0.193-0.433,0.432s0.194,0.432,0.433,0.432h2.591c0.238,0,0.432-0.193,0.432-0.432S19.307,9.568,19.068,9.568 M14.886,14.274c-0.169-0.168-0.442-0.168-0.611,0c-0.169,0.169-0.169,0.442,0,0.611l1.833,1.832c0.168,0.169,0.441,0.169,0.61,0s0.169-0.442,0-0.61L14.886,14.274z M10,4.818c-2.861,0-5.182,2.32-5.182,5.182c0,2.862,2.321,5.182,5.182,5.182s5.182-2.319,5.182-5.182C15.182,7.139,12.861,4.818,10,4.818M10,14.318c-2.385,0-4.318-1.934-4.318-4.318c0-2.385,1.933-4.318,4.318-4.318c2.386,0,4.318,1.933,4.318,4.318C14.318,12.385,12.386,14.318,10,14.318 M10,16.045c-0.238,0-0.432,0.193-0.432,0.433v2.591c0,0.238,0.194,0.432,0.432,0.432s0.432-0.193,0.432-0.432v-2.591C10.432,16.238,10.238,16.045,10,16.045" />\n            </svg>\n            <svg viewBox="0 0 20 20">\n              <path d="M10.544,8.717l1.166-0.855l1.166,0.855l-0.467-1.399l1.012-0.778h-1.244L11.71,5.297l-0.466,1.244H10l1.011,0.778L10.544,8.717z M15.986,9.572l-0.467,1.244h-1.244l1.011,0.777l-0.467,1.4l1.167-0.855l1.165,0.855l-0.466-1.4l1.011-0.777h-1.244L15.986,9.572z M7.007,6.552c0-2.259,0.795-4.33,2.117-5.955C4.34,1.042,0.594,5.07,0.594,9.98c0,5.207,4.211,9.426,9.406,9.426c2.94,0,5.972-1.354,7.696-3.472c-0.289,0.026-0.987,0.044-1.283,0.044C11.219,15.979,7.007,11.759,7.007,6.552 M10,18.55c-4.715,0-8.551-3.845-8.551-8.57c0-3.783,2.407-6.999,5.842-8.131C6.549,3.295,6.152,4.911,6.152,6.552c0,5.368,4.125,9.788,9.365,10.245C13.972,17.893,11.973,18.55,10,18.55 M19.406,2.304h-1.71l-0.642-1.71l-0.642,1.71h-1.71l1.39,1.069l-0.642,1.924l1.604-1.176l1.604,1.176l-0.642-1.924L19.406,2.304z" />\n          </svg>'),s.addEventListener("click",(e=>{e.stopPropagation(),this.switchTheme()})),this.theme={element:s,options:["light","dark"]},this.theme.value=this.theme.options.indexOf(document.body.className),this.setThemeIcon(),a.textContent="logout",i.appendChild(a),i.insertAdjacentHTML("beforeend",'<svg class="svg-icon" viewBox="0 0 20 20">\n                  <polygon points="18.198,7.95 3.168,7.95 3.168,8.634 9.317,9.727 9.317,19.564 12.05,19.564 12.05,9.727 18.198,8.634 "></polygon>\n                  <path d="M2.485,10.057v-3.41H2.473l0.012-4.845h1.366c0.378,0,0.683-0.306,0.683-0.683c0-0.378-0.306-0.683-0.683-0.683H1.119c-0.378,0-0.683,0.306-0.683,0.683c0,0.378,0.306,0.683,0.683,0.683h0.683v4.845C1.406,6.788,1.119,7.163,1.119,7.609v2.733c0,0.566,0.459,1.025,1.025,1.025c0.053,0,0.105-0.008,0.157-0.016l-0.499,5.481l5.9,2.733h0.931C8.634,13.266,5.234,10.458,2.485,10.057z"></path>\n                  <path d="M18.169,6.584c-0.303-3.896-3.202-6.149-7.486-6.149c-4.282,0-7.183,2.252-7.484,6.149H18.169z M15.463,3.187c0.024,0.351-0.103,0.709-0.394,0.977c-0.535,0.495-1.405,0.495-1.94,0c-0.29-0.268-0.418-0.626-0.394-0.977C13.513,3.827,14.683,3.827,15.463,3.187z"></path>\n                  <path d="M18.887,10.056c-2.749,0.398-6.154,3.206-6.154,9.508h0.933l5.899-2.733L18.887,10.056z"></path>\n\t\t\t\t\t\t  </svg>'),i.addEventListener("click",(e=>{e.stopPropagation(),socket.close()})),this.navbar.ul.append(s,i),this.loadTab(this.tabs.active),this.tabs.data={},loadOut([this.wrapper,this.navbar.wrapper,this.topbar.wrapper,this.chat.wrapper]),fadeIn(this.tabs.item[this.tabs.active].tab),e.attempts_total>2&&msg.new({content:`Bienvenue ${e.name} !\n                    Pour information, ${e.attempts_total} tentatives de connexion\n                    à votre compte ont échoué depuis la dernière connexion réussie.\n                    Si ce nombre vous paraît anormal, vérifiez que votre compte soit bien sécurisé.`})}appendNav(e){}static destroy(){const e=ClassMain.el;e.chat.destroy(),e.wrapper.innerHTML="",e.navbar.wrapper.innerHTML="",e.navbar.wrapper.className="navbar left hidden loading",e.navbar.wrapper.style.top="",e.navbar.wrapper.style.left="",e.topbar.wrapper.innerHTML="",e.topbar.wrapper.className="topbar hidden loading",delete ClassMain.el}getTab(){}logout(){}navbarRelease(){const e=Array.from(this.navbar.wrapper.classList).filter((e=>["top","right","bottom","left"].includes(e)));1!==e.length||"top"!==e[0]&&"bottom"!==e[0]?localStorage.setItem("navbarStyle",this.navbar.wrapper.getAttribute("style")):localStorage.removeItem("navbarStyle"),localStorage.setItem("navbarClass",e.join(" "))}navbarSetMain(){this.wrapper.classList.remove("menu-left","menu-right"),this.navbar.wrapper.classList.contains("left")?this.wrapper.classList.add("menu-left"):this.navbar.wrapper.classList.contains("right")&&this.wrapper.classList.add("menu-right")}parseTab(e,t){this.tabs.data[e]=t,this.loadTab(e)}prepareTab(map,parentId=null){for(const[id,children]of Object.entries(map))if(this.tabs.data[id]){let newtab=document.createElement("div"),newnav=document.createElement("li"),navText=document.createElement("span");if(newtab.className=this.tabs.active===id?"tab":"tab fadeout",navText.textContent=this.tabs.data[id].name,newnav.insertAdjacentHTML("beforeend",this.tabs.data[id].icon.length>0?this.tabs.data[id].icon:'<svg class="svg-icon" viewBox="0 0 20 20">\n                  <polygon points="18.198,7.95 3.168,7.95 3.168,8.634 9.317,9.727 9.317,19.564 12.05,19.564 12.05,9.727 18.198,8.634 "></polygon>\n                  <path d="M2.485,10.057v-3.41H2.473l0.012-4.845h1.366c0.378,0,0.683-0.306,0.683-0.683c0-0.378-0.306-0.683-0.683-0.683H1.119c-0.378,0-0.683,0.306-0.683,0.683c0,0.378,0.306,0.683,0.683,0.683h0.683v4.845C1.406,6.788,1.119,7.163,1.119,7.609v2.733c0,0.566,0.459,1.025,1.025,1.025c0.053,0,0.105-0.008,0.157-0.016l-0.499,5.481l5.9,2.733h0.931C8.634,13.266,5.234,10.458,2.485,10.057z"></path>\n                  <path d="M18.169,6.584c-0.303-3.896-3.202-6.149-7.486-6.149c-4.282,0-7.183,2.252-7.484,6.149H18.169z M15.463,3.187c0.024,0.351-0.103,0.709-0.394,0.977c-0.535,0.495-1.405,0.495-1.94,0c-0.29-0.268-0.418-0.626-0.394-0.977C13.513,3.827,14.683,3.827,15.463,3.187z"></path>\n                  <path d="M18.887,10.056c-2.749,0.398-6.154,3.206-6.154,9.508h0.933l5.899-2.733L18.887,10.056z"></path>\n\t\t\t\t\t\t  </svg>'),newnav.appendChild(navText),newnav.addEventListener("click",(e=>{e.stopPropagation(),this.tabSwitch(id)})),this.wrapper.appendChild(newtab),this.tabs.item[id]={tab:newtab,li:newnav},this.tabs.data[id].actions?.length>0)for(const value of this.tabs.data[id].actions){let newAction=document.createElement("li"),text=document.createElement("span");if(text.textContent=value.name,newAction.insertAdjacentHTML("beforeend",value.icon??'<svg viewBox="0 0 20 20">\n\t\t\t\t\t\t\t<path d="M17.645,7.262c-0.238-0.419-0.547-0.681-0.889-0.681C15.971,3.462,13.43,0.5,11.192,0.5C10.79,0.5,10.39,0.598,10,0.772C9.61,0.598,9.21,0.5,8.808,0.5c-2.238,0-4.779,2.962-5.564,6.08c-0.342,0-0.651,0.262-0.889,0.681C1.302,7.294,0.542,8.415,0.542,9.958c0,1.566,0.781,2.702,1.858,2.702c0.212,0,0.409-0.056,0.594-0.139c0.478,1.431,1.355,1.868,1.939,1.997v2.195c0,0.187,0.151,0.338,0.338,0.338c0.187,0,0.338-0.151,0.338-0.338v-0.778c0.488,0.874,1.471,1.566,2.702,1.903v0.564c0,0.187,0.151,0.338,0.338,0.338s0.338-0.151,0.338-0.338v-0.418c0.22,0.034,0.446,0.056,0.676,0.068v1.026c0,0.187,0.151,0.338,0.338,0.338s0.338-0.151,0.338-0.338v-1.026c0.23-0.012,0.456-0.033,0.676-0.068v0.418c0,0.187,0.151,0.338,0.338,0.338s0.338-0.151,0.338-0.338V17.84c1.232-0.337,2.215-1.029,2.702-1.903v0.778c0,0.187,0.151,0.338,0.338,0.338s0.338-0.151,0.338-0.338v-2.195c0.587-0.131,1.462-0.569,1.939-1.997c0.186,0.083,0.382,0.139,0.594,0.139c1.077,0,1.858-1.137,1.858-2.702C19.458,8.415,18.698,7.294,17.645,7.262z M2.4,11.647c-0.466,0-0.844-0.756-0.844-1.689c0-0.558,0.137-1.049,0.346-1.357c0.487,0.122,1.083,0.582,1.276,2.018C3.048,11.224,2.749,11.647,2.4,11.647z M12.094,7.98c0.171-0.171,0.737,0.119,1.264,0.647c0.528,0.528,0.817,1.094,0.647,1.264c-0.171,0.171-0.737-0.119-1.264-0.647C12.213,8.717,11.923,8.151,12.094,7.98z M6.66,8.627C7.188,8.099,7.754,7.81,7.924,7.98c0.171,0.171-0.119,0.737-0.647,1.264C6.75,9.772,6.184,10.062,6.013,9.891C5.843,9.721,6.132,9.155,6.66,8.627z M14.701,13.216c-0.04,0.005-0.08,0.008-0.12,0.008c-0.76,0-1.409-0.939-1.484-1.051c-1.236-1.855-3.078-1.876-3.097-1.876c-0.075,0.001-1.869,0.034-3.097,1.876c-0.079,0.118-0.798,1.144-1.604,1.043c-0.451-0.061-0.796-0.439-1.025-1.124l0.641-0.214c0.134,0.402,0.306,0.645,0.472,0.668c0.286,0.041,0.735-0.424,0.953-0.749C7.776,9.646,9.91,9.621,10,9.621s2.224,0.025,3.659,2.177c0.218,0.325,0.683,0.789,0.953,0.748c0.166-0.022,0.338-0.266,0.472-0.668l0.641,0.214C15.497,12.777,15.152,13.155,14.701,13.216z M17.6,11.647c-0.349,0-0.649-0.424-0.777-1.028c0.193-1.435,0.789-1.895,1.276-2.018c0.209,0.308,0.346,0.798,0.346,1.357C18.445,10.891,18.067,11.647,17.6,11.647z"></path>\n\t\t\t\t\t\t                </svg>'),newAction.appendChild(text),newAction.addEventListener("pointerdown",(e=>{e.stopPropagation()})),newAction.addEventListener("click",(e=>{e.stopPropagation(),eval(value.action)})),!this.tabs.item[id].ul){const e=document.createElement("ul");newnav.appendChild(e),this.tabs.item[id].ul=e}this.tabs.item[id].ul.appendChild(newAction)}if(parentId){const e=this.tabs.item[parentId];if(!e.ul){const t=document.createElement("ul");e.li.appendChild(t),e.ul=t}e.ul.appendChild(newnav)}else this.navbar.ul.appendChild(newnav);"object"==typeof children&&this.prepareTab(children,id)}}setThemeIcon(){for(let[e,t]of this.theme.options.entries()){const t=this.theme.element.getElementsByTagName("svg")[e];e===this.theme.value?t.classList.remove("hide"):t.classList.add("hide")}}switchTheme(){this.theme.value=this.theme.value<this.theme.options.length-1?this.theme.value+1:0;const e=this.theme.options[this.theme.value];this.setThemeIcon(),document.body.className=e,localStorage.setItem("theme",e)}tabSwitch(e){0===this.tabs.item[e].tab.children.length?this.loadTab(e):this.topbar.react.innerHTML=this.tabs.data[e]?.toolbar??"",localStorage.setItem("active_tab",e),fadeOut(this.tabs.item[this.tabs.active].tab),this.tabs.item[this.tabs.active].li.classList.remove("active"),fadeIn(this.tabs.item[e].tab),this.tabs.item[e].li.classList.add("active"),this.tabs.active=e}loadTab(e){if(this.tabs.data[e]?.fields){let t=document.createElement("h1");t.textContent=this.tabs.data[e].name,this.tabs.item[e].tab.appendChild(t);for(const t of this.tabs.data[e].fields)this.tabs.item[e].tab.appendChild(new Field(t).wrapper);this.topbar.react.innerHTML=this.tabs.data[e].toolbar??""}else socket.send({f:20,i:e})}}themifyCache(),login.load(),window.onload=document.body.classList.remove("loading");class Modal{static modals=[];static focus=[];static maxModals=5;static maxChildren=5;constructor(e){if(this.childOf=e.childOf??void 0,!this.hasRoom())return msg.new({content:"Vous avez atteint le nombre maximal de fenêtres ouvertes.",type:"warning"});{const t=document.getElementsByClassName("modal-container")[0];this.task=e.task,this.wrapper=document.createElement("div"),this.header=document.createElement("div"),this.content=document.createElement("div"),this.footer=document.createElement("div"),this.children=[],this.fields=[],this.title=document.createElement("h2"),this.wrapper.className="modal fadeout",e.grid&&this.content.classList.add("g-6"),this.title.textContent=e.title,this.content.addEventListener("pointerdown",(e=>e.stopPropagation()));for(const t of e.fields){const e=new Field(t);this.content.appendChild(e.wrapper),this.fields.push(e)}let s=document.createElement("button"),n=!!e.btn1text&&document.createElement("button"),i=!!e.btn2text&&document.createElement("button");if(s.classList.add(e.btn0style??"danger"),s.textContent=e.btn0text??"annuler",s.addEventListener("click",(t=>{e.btn0listener?e.btn0listener(t):msg.new({content:"Êtes-vous sûr de vouloir annuler ? Toutes les informations rentrées seront perdues.",type:"warning",btn1text:"continuer",btn1style:"success",btn1listener:function(){Modal.find(s).close(),msg.close()}})})),this.footer.appendChild(s),n){let t=this;n.textContent=e.btn1text,n.addEventListener("click",e.btn1listener??(()=>t.modalOk())),n.classList.add(e.btn1style??"success"),this.footer.appendChild(n)}i&&(i.textContent=e.btn2text,i.addEventListener("click",e.btn2listener),i.classList.add(e.btn2style??"success"),this.footer.appendChild(i)),this.btns=this.footer.getElementsByTagName("button"),this.header.appendChild(this.title),this.wrapper.append(this.header,this.content,this.footer),void 0===this.childOf?(t.appendChild(this.wrapper),setElementDraggable(this.wrapper,{constrain:!0}),Modal.modals.push(this),this.wrapper.addEventListener("pointerdown",(e=>{Modal.find(e.currentTarget).setFocus()})),this.setFocus()):(this.parentId=e.parentId??void 0,this.childOf.wrapper.appendChild(this.wrapper),Modal.findParent(this.childOf).children.push(this)),this.checkRequiredFields(),fadeIn(this.wrapper),this.wrapper.getElementsByTagName("input")[0]?.focus()}}checkRequiredFields(){for(const e of this.fields)if(e.required&&!e.isValid){for(const e of this.btns)e!==this.btns[0]&&disable(e);return!1}for(const e of this.btns)e!==this.btns[0]&&enable(e);return!0}close(){void 0!==this.childOf?Modal.findParent(this.childOf).children.splice(this.childOf.children.indexOf(this),1):Modal.modals.splice(Modal.modals.indexOf(this),1);for(const e of this.fields)e.destroy();this.wrapper.remove()}static destroy(){for(let e=Modal.modals.length-1;e>=0;e--)Modal.modals[e].close()}static find(e){for(const t of Modal.modals){for(let s=t.children.length-1;s>=0;s--){const n=t.children[s];if(n.wrapper===e||n.wrapper.contains(e))return n}if(t.wrapper===e||t.wrapper.contains(e))return t}return!1}static findParent(e){for(const t of Modal.modals)if(t.wrapper.contains(e.wrapper))return t;return e}getData(){const e=Modal.findParent(this);let t={child:e.children.indexOf(this),f:this.task,parent:Modal.modals.indexOf(e)},s={};for(const e of this.fields)switch(e.type){case"phone":s[e.name]=e.phone??null;break;case"selectize":s[e.name]=e.selected.items.map((e=>e.id))??void 0;break;case"select":s[e.name]=e.selected;break;default:for(const t of e.input)t.value&&(s[t.getAttribute("aria-label")]=t.value)}return t.content=s,t}hasRoom(){return(void 0===this.childOf||Modal.findParent(this.childOf).children.length!==Modal.maxChildren)&&Modal.modals.length!==Modal.maxModals}modalOk(e){let t;void 0!==e&&e.confirm?(t=e.data,t.confirm=e.confirm):t=this.getData(),console.warn(t),socket.send(t)}static parseData(e){const t=-1===e.child?Modal.modals[e.parent]:Modal.modals[e.parent].children[e.child];switch(e.f){case 8:msg.new({content:e.response.success,type:"success",btn0listener:()=>t.close()});break;case 9:if(e.response.confirm){const s=e.response.confirm.content;delete e.response,delete e.user,msg.new({content:s,btn1listener:()=>{t.modalOk({confirm:"new",data:e}),msg.close()},btn1text:"créer",btn2listener:()=>{msg.new({content:"Under construction.",type:"warning"}),msg.close()},btn2text:"consulter",type:"warning"})}else refreshTabData(document.querySelector(".tab:not(.fadeout)")),msg.new({content:e.response.success,type:"success",btn0listener:()=>t.close()});break;case 10:case 11:(t.childOf??null)?.fields[t.parentId].addSelectize(e.response.id,e.response.name),msg.new({content:e.response.success,type:"success",btn0listener:()=>t.close()})}}setFocus(){const e=Modal.modals.indexOf(this);Modal.focus.includes(e)?Modal.focus.push(Modal.focus.splice(Modal.focus.indexOf(e),1)[0]):Modal.focus.push(e);let t=20;for(const e of Modal.focus)Modal.modals[e]?Modal.modals[e].wrapper.style["z-index"]=t++:Modal.focus.splice(Modal.focus.indexOf(e),1)}static setMaxChildren(e){Modal.maxChildren=e}static setMaxModals(e){Modal.maxModals=e}}function loadNewCompany(e){let t,s,n,i="";e&&(t=e.email??"",s=e.childOf??void 0,n=e.parentId??void 0,i=e.name??"");const a={btn1text:"créer",btn1style:"success",fields:[{compact:!0,name:"Nom",placeholder:"Evil Corp",required:!0,type:"input_string",value:i},{compact:!0,name:"Adresse email",placeholder:"contact@evil.corp",required:!0,type:"email",value:t},{compact:!0,label:"Téléphone",name:"Téléphone",placeholder:"0601234567",type:"phone"},{compact:!0,name:"Adresse",type:"address"},{add:e=>{const t=Modal.find(e),s=t.fields.indexOf(Field.find(e));loadNewContact({childOf:t,name:e.value,parentId:s})},compact:!0,multi:!0,name:"Employés",placeholder:"Tannen Biff, McFly Marty...",task:3,type:"selectize"},{add:e=>modalAddTag(e),compact:!0,multi:!0,name:"Tags",placeholder:"Serpentard, moldu...",task:1,type:"selectize"}],childOf:s,parentId:n,task:11,title:"Nouvelle entreprise"};new Modal(a)}function loadNewContact(e){let t,s,n,i="",a="";if(e&&(t=e.email??"",s=e.childOf??void 0,n=e.parentId??void 0,void 0!==e.name)){const t=e.name.split(" ");if(t.length>1){i=t.shift();for(const e of t)a=a+" "+e}else i=e.name}const o={btn1text:"créer",btn1style:"success",btn2modalOnly:!0,btn2text:"créer & ticket",btn2style:"info",btn2listener:function(){console.log("create contact, then change modal to new ticket with created contact as client"),unblurElements([modalContainer,navbar,topbar,main]),fadeOut(modalContainer),resetModal(modal)},fields:[{compact:!0,name:"Nom",placeholder:"Nom",required:!0,type:"input_string",value:a.trim()},{compact:!0,name:"Prénom",placeholder:"Prénom",required:!0,type:"input_string",value:i},{add:e=>{const t=Modal.find(e),s=t.fields.indexOf(Field.find(e));loadNewCompany({childOf:t,name:e.value,parentId:s})},compact:!0,multi:!1,name:"Société",placeholder:"Société",task:2,type:"selectize"},{compact:!0,name:"Adresse email",placeholder:"Adresse email",required:!0,type:"email",value:t},{compact:!0,name:"Téléphone portable",placeholder:"0601234567",type:"phone"},{compact:!0,name:"Adresse",type:"address"},{add:e=>{msg.new({content:`Souhaitez-vous créer le tag ${e.value} ?`,btn1text:"Créer",btn1style:"success",btn1listener:async function(){socket.send({f:12,t:e.value,x:Field.fields.indexOf(Field.find(e))}),e.value="",msg.close(),e.focus()}})},compact:!0,multi:!0,name:"Tags",placeholder:"Étiquettes",task:1,type:"selectize"}],childOf:s,parentId:n,task:10,title:"Nouveau contact"};new Modal(o)}function loadNewEmail(e){let t;if(e){t=[];for(const s of e)t.push(s)}const s={btn1text:"Envoyer",btn1style:"success",btn2modalOnly:!1,btn2text:"Envoi décalé",btn2style:"info",btn2listener:function(){console.log("show date/hour picker and program mail sending"),msg.new({content:"Under construction",type:"warning"})},fields:[{add:e=>{const t=Modal.find(e),s=t.fields.indexOf(Field.find(e));loadNewContact({childOf:t,name:e.value,parentId:s})},compact:!0,multi:!0,name:"Destinataire",placeholder:"Destinataire",required:!0,task:0,type:"selectize",value:t},{add:e=>{const t=Modal.find(e),s=t.fields.indexOf(Field.find(e));loadNewContact({childOf:t,name:e.value,parentId:s})},compact:!0,multi:!0,name:"Cc",placeholder:"Copie carbone",task:0,type:"selectize",collapsible:!0},{add:e=>{const t=Modal.find(e),s=t.fields.indexOf(Field.find(e));loadNewContact({childOf:t,name:e.value,parentId:s})},compact:!0,multi:!0,name:"Cci",placeholder:"Copie carbone invisible",task:0,type:"selectize",collapsible:!0},{compact:!0,name:"Sujet",placeholder:"Sujet de votre email",required:!0,type:"input_string"},{compact:!0,name:"Contenu",placeholder:"Contenu de votre email.",required:!0,type:"quill"}],task:8,title:"Rédiger nouvel email"};new Modal(s)}function loadNewTicket(e){const t={btn1text:"créer",btn1style:"success",btn2modalOnly:!0,btn2text:"créer & ouvrir",btn2style:"info",btn2listener:function(){console.log("create ticket, then close modal and open ticket"),unblurElements([modalContainer,navbar,topbar,main]),fadeOut(modalContainer),resetModal(modal)},fields:[{add:e=>{const t=Modal.find(e),s=t.fields.indexOf(Field.find(e));loadNewContact({childOf:t,name:e.value,parentId:s})},compact:!0,multi:!1,name:"Client",placeholder:"Hunter Rick",required:!0,task:3,type:"selectize",value:e??void 0},{compact:!0,name:"Sujet",placeholder:"Problème de solanum tuberosum.",required:!0,type:"input_string"},{compact:!0,name:"Description",placeholder:"C'est tout ce que ça te fait quand j'te dis qu'on va manger des chips ?",type:"input_text"},{compact:!0,name:"État",task:7,type:"select"},{compact:!0,name:"Type",task:5,type:"select"},{compact:!0,name:"Priorité",placeholder:"Vital",task:6,type:"select"},{compact:!0,multi:!1,name:"Attribué à",placeholder:"Cuisine",required:!0,task:4,type:"selectize"},{add:e=>modalAddTag(e),compact:!0,multi:!0,name:"Tags",placeholder:"Serpentard, moldu...",task:1,type:"selectize"}],task:9,title:"Nouveau ticket"};new Modal(t)}function loadTicket(e){e>0&&socket.send({f:13,i:e})}document.addEventListener("mousemove",(e=>{e.target&&document.activeElement!==e.target&&"button"===e.target.nodeName.toLowerCase()&&"button"===document.activeElement.nodeName.toLocaleLowerCase()&&e.target.focus()}));const pages=[{name:"Accueil",role:["1","2"],icon:'<svg class="svg-icon" viewBox="0 0 20 20">\n      <path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>\n    </svg>',fields:[{name:"Test Table",options:{tableHead:{fixed:!0},scroll:"infinite",task:0},type:"sweettable"}],toolbar:"<li>TOOLS accueil</li>"},{name:"Tickets",role:["1","2"],fields:[{name:"Tickets",options:{tableHead:{fixed:!0},scroll:"infinite",task:0},type:"sweettable"}],icon:'<svg class="svg-icon" viewBox="0 0 20 20">\n      <path d="M17.896,12.706v-0.005v-0.003L15.855,2.507c-0.046-0.24-0.255-0.413-0.5-0.413H4.899c-0.24,0-0.447,0.166-0.498,0.4L2.106,12.696c-0.008,0.035-0.013,0.071-0.013,0.107v4.593c0,0.28,0.229,0.51,0.51,0.51h14.792c0.28,0,0.51-0.229,0.51-0.51v-4.593C17.906,12.77,17.904,12.737,17.896,12.706 M5.31,3.114h9.625l1.842,9.179h-4.481c-0.28,0-0.51,0.229-0.51,0.511c0,0.703-1.081,1.546-1.785,1.546c-0.704,0-1.785-0.843-1.785-1.546c0-0.281-0.229-0.511-0.51-0.511H3.239L5.31,3.114zM16.886,16.886H3.114v-3.572H7.25c0.235,1.021,1.658,2.032,2.75,2.032c1.092,0,2.515-1.012,2.749-2.032h4.137V16.886z"></path>\n        </svg>',toolbar:"<li>Filters</li>\n        <li>Vues</li>"},{name:"Produits",role:["1","3"],icon:'<svg class="svg-icon" viewBox="0 0 20 20">\n        <path d="M17.638,6.181h-3.844C13.581,4.273,11.963,2.786,10,2.786c-1.962,0-3.581,1.487-3.793,3.395H2.362c-0.233,0-0.424,0.191-0.424,0.424v10.184c0,0.232,0.191,0.424,0.424,0.424h15.276c0.234,0,0.425-0.191,0.425-0.424V6.605C18.062,6.372,17.872,6.181,17.638,6.181 M13.395,9.151c0.234,0,0.425,0.191,0.425,0.424S13.629,10,13.395,10c-0.232,0-0.424-0.191-0.424-0.424S13.162,9.151,13.395,9.151 M10,3.635c1.493,0,2.729,1.109,2.936,2.546H7.064C7.271,4.744,8.506,3.635,10,3.635 M6.605,9.151c0.233,0,0.424,0.191,0.424,0.424S6.838,10,6.605,10c-0.233,0-0.424-0.191-0.424-0.424S6.372,9.151,6.605,9.151 M17.214,16.365H2.786V7.029h3.395v1.347C5.687,8.552,5.332,9.021,5.332,9.575c0,0.703,0.571,1.273,1.273,1.273c0.702,0,1.273-0.57,1.273-1.273c0-0.554-0.354-1.023-0.849-1.199V7.029h5.941v1.347c-0.495,0.176-0.849,0.645-0.849,1.199c0,0.703,0.57,1.273,1.272,1.273s1.273-0.57,1.273-1.273c0-0.554-0.354-1.023-0.849-1.199V7.029h3.395V16.365z"></path>\n\t\t</svg>',fields:[{name:"Produits",options:{tableHead:{fixed:!0},scroll:"infinite",task:1},type:"sweettable"}],toolbar:"<li>Filters</li>\n    <li>Import</li>"},{name:"Entreprises",role:["1","3"],icon:'<svg class="svg-icon" viewBox="0 0 20 20">\n\t\t<path d="M17.283,5.549h-5.26V4.335c0-0.222-0.183-0.404-0.404-0.404H8.381c-0.222,0-0.404,0.182-0.404,0.404v1.214h-5.26c-0.223,0-0.405,0.182-0.405,0.405v9.71c0,0.223,0.182,0.405,0.405,0.405h14.566c0.223,0,0.404-0.183,0.404-0.405v-9.71C17.688,5.731,17.506,5.549,17.283,5.549 M8.786,4.74h2.428v0.809H8.786V4.74z M16.879,15.26H3.122v-4.046h5.665v1.201c0,0.223,0.182,0.404,0.405,0.404h1.618c0.222,0,0.405-0.182,0.405-0.404v-1.201h5.665V15.26z M9.595,9.583h0.81v2.428h-0.81V9.583zM16.879,10.405h-5.665V9.19c0-0.222-0.183-0.405-0.405-0.405H9.191c-0.223,0-0.405,0.183-0.405,0.405v1.215H3.122V6.358h13.757V10.405z"></path>\n        </svg>',fields:[{name:"Fournisseurs",options:{tableHead:{fixed:!0},scroll:"infinite",task:2},type:"sweettable"}],toolbar:"<li>Filters</li>\n    <li>Import</li>"},{name:"Contacts",role:["1"],icon:'<svg class="svg-icon" viewBox="0 0 20 20">\n      <path d="M8.749,9.934c0,0.247-0.202,0.449-0.449,0.449H4.257c-0.247,0-0.449-0.202-0.449-0.449S4.01,9.484,4.257,9.484H8.3C8.547,9.484,8.749,9.687,8.749,9.934 M7.402,12.627H4.257c-0.247,0-0.449,0.202-0.449,0.449s0.202,0.449,0.449,0.449h3.145c0.247,0,0.449-0.202,0.449-0.449S7.648,12.627,7.402,12.627 M8.3,6.339H4.257c-0.247,0-0.449,0.202-0.449,0.449c0,0.247,0.202,0.449,0.449,0.449H8.3c0.247,0,0.449-0.202,0.449-0.449C8.749,6.541,8.547,6.339,8.3,6.339 M18.631,4.543v10.78c0,0.248-0.202,0.45-0.449,0.45H2.011c-0.247,0-0.449-0.202-0.449-0.45V4.543c0-0.247,0.202-0.449,0.449-0.449h16.17C18.429,4.094,18.631,4.296,18.631,4.543 M17.732,4.993H2.46v9.882h15.272V4.993z M16.371,13.078c0,0.247-0.202,0.449-0.449,0.449H9.646c-0.247,0-0.449-0.202-0.449-0.449c0-1.479,0.883-2.747,2.162-3.299c-0.434-0.418-0.714-1.008-0.714-1.642c0-1.197,0.997-2.246,2.133-2.246s2.134,1.049,2.134,2.246c0,0.634-0.28,1.224-0.714,1.642C15.475,10.331,16.371,11.6,16.371,13.078M11.542,8.137c0,0.622,0.539,1.348,1.235,1.348s1.235-0.726,1.235-1.348c0-0.622-0.539-1.348-1.235-1.348S11.542,7.515,11.542,8.137 M15.435,12.629c-0.214-1.273-1.323-2.246-2.657-2.246s-2.431,0.973-2.644,2.246H15.435z"></path>\n    </svg>',fields:[{name:"Contacts",options:{tableHead:{fixed:!0},scroll:"infinite",task:3},type:"sweettable"}],toolbar:"<li>Filters</li>\n    <li>Import</li>"},{name:"Stats",role:["1"],icon:'<svg class="svg-icon" viewBox="0 0 20 20">\n      <path d="M17.431,2.156h-3.715c-0.228,0-0.413,0.186-0.413,0.413v6.973h-2.89V6.687c0-0.229-0.186-0.413-0.413-0.413H6.285c-0.228,0-0.413,0.184-0.413,0.413v6.388H2.569c-0.227,0-0.413,0.187-0.413,0.413v3.942c0,0.228,0.186,0.413,0.413,0.413h14.862c0.228,0,0.413-0.186,0.413-0.413V2.569C17.844,2.342,17.658,2.156,17.431,2.156 M5.872,17.019h-2.89v-3.117h2.89V17.019zM9.587,17.019h-2.89V7.1h2.89V17.019z M13.303,17.019h-2.89v-6.651h2.89V17.019z M17.019,17.019h-2.891V2.982h2.891V17.019z"></path>\n    </svg>',fields:[],toolbar:"<li>Filters</li>\n    <li>Vues</li>"}];function pageSelector(e){let t=[];for(const s of e)for(let e=0;e<pages.length;e++)if(!t.includes(e))for(let n=0;n<pages[e].role.length;n++)parseInt(s)===parseInt(pages[e].role[n])&&t.push(e);return t}function removePages(){tabuDestroy(main),main.innerHTML=""}function quicksort(e,t=0){if(e.length>1){const s=performance.now(),n=typeof e[0],i="object"===n?arr_ssb:num_ssb,a="object"===n?arr_iqp:num_iqp,o="object"===n?arr_is:num_is;let r=[],l=[0,e.length,2*Math.floor(Math.log(e.length)/Math.log(2))];for(r.push(l);r.length>0;){l=r.pop();const s=l[0],n=l[1],o=Math.round((s+n)/2);let c=l[2];if(0===c){e=i(e,s,n,t);continue}c--;const d=a(e,s,n,o,t);n-d>16&&(l=[d,n,c],r.push(l)),d-s>16&&(l=[s,d,c],r.push(l))}e=o(e,t),console.log(performance.now()-s+"ms quicksort")}return e}function arrCompare(e,t,s){for(let n=0;n<s.length;n++){let i,a;if(i=e[s[n][1]]?"object"==typeof e[s[n][1]]?e[s[n][1]][0]:e[s[n][1]]:"",a=t[s[n][1]]?"object"==typeof t[s[n][1]]?t[s[n][1]][0]:t[s[n][1]]:"",i="string"==typeof i?i.toLowerCase():i,a="string"==typeof a?a.toLowerCase():a,i!==a)return 0===s[n][0]?i>a:a>i}}function objCompare(e,t,s){for(let n=0;n<s.length;n++){const i=s[n][1],a=s[n][0];if(e[i]!==t[i])return 0===a&&e[i]>t[i]||1===a&&e[i]<t[i]}}function num_ssb(e,t,s,n){let i,a,o,r=Math.round((t+s)/2);for(;r>=t;){for(i=r;i<s;i++){if(o=e[i],a=i,0===n)for(;a>=r&&e[a-r]>o;)e[a]=e[a-r],a-=r;else for(;a>=r&&e[a-r]<o;)e[a]=e[a-r],a-=r;e[a]=o}r=Math.round(r/2.2)}return e}function arr_ssb(e,t,s,n){let i,a,o,r=Math.round((t+s)/2);for(;r>=t;){for(i=r;i<s;i++){for(o=e[i],a=i;a>=r&&arrCompare(e[a-r],o,n);)e[a]=e[a-r],a-=r;e[a]=o}r=Math.round(r/2.2)}return e}function obj_shell_sort_bound(e,t,s,n){let i,a,o,r=Math.round((t+s)/2);for(;r>=t;){for(i=r;i<s;i++){for(o=e[i],a=i;a>=r&&objCompare(e[a-r],o,n);)e[a]=e[a-r],a-=r;e[a]=o}r=Math.round(r/2.2)}return e}function num_iqp(e,t,s,n,i){let a=t,o=s;const r=e[n];for(;;){if(0===i){for(;e[a]<r;)a++;for(o--;r<e[o];)o--}else{for(;e[a]>r;)a++;for(o--;r>e[o];)o--}if(!(a<o))return a;swap(e,a,o),a++}}function arr_iqp(e,t,s,n,i){let a=t,o=s;const r=e[n];for(;;){for(;arrCompare(r,e[a],i);)a++;for(o--;arrCompare(e[o],r,i);)o--;if(!(a<o))return a;swap(e,a,o),a++}}function obj_inplace_quicksort_partition(e,t,s,n,i){let a=t,o=s;const r=e[n];for(;;){for(;objCompare(r,e[a],i);)a++;for(o--;objCompare(e[o],r,i);)o--;if(!(a<o))return a;swap(e,a,o),a++}}function num_is(e,t,s){for(let s=1,n=e.length;s<n;s++){const n=e[s];let i;for(i=s-1;i>=0&&!(0===t&&e[i]<=n)&&!(1===t&&e[i]>=n);i--)e[i+1]=e[i];e[i+1]=n}return e}function arr_is(e,t){for(let s=1,n=e.length;s<n;s++){const n=e[s];let i;for(i=s-1;i>=0&&(e[i]!==n&&!arrCompare(n,e[i],t));i--)e[i+1]=e[i];e[i+1]=n}return e}function obj_insertion_sort(e,t){for(let s=1,n=e.length;s<n;s++){const n=e[s];let i;for(i=s-1;i>=0&&(e[i]!==n&&!objCompare(n,e[i],t));i--)e[i+1]=e[i];e[i+1]=n}return e}function swap(e,t,s){const n=e[t];e[t]=e[s],e[s]=n}function dataGen(e,t){let s=[];const n=e=>{let t="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=s.length;for(var i=0;i<e;i++)t+=s.charAt(Math.floor(Math.random()*n));return t};for(var i=0;i<e;i++)0===t?s[i]=Math.round(1e6*Math.random()):1===t?s[i]={id:Math.round(1e6*Math.random()),simpal:n(1),dual:n(2),quintal:n(5),tenal:n(10)}:2===t?s[i]=[Math.round(1e6*Math.random()),n(1),n(2),n(5),n(10)]:3===t&&(s[i]=[Math.round(10*Math.random()),Math.round(10*Math.random()),Math.round(10*Math.random()),Math.round(10*Math.random()),Math.round(10*Math.random())]);return s}function builtInSortNum(e){const t=performance.now();e.sort(((e,t)=>e-t)),console.log(performance.now()-t)}function builtInSortArr(e,t,s,n,i){const a=performance.now();e.sort(((e,a)=>e[t]===a[t]?e[s]===a[s]?e[n]===a[n]?e[i]>a[i]:e[n]>a[n]:e[s]>a[s]:e[t]>a[t])),console.log(performance.now()-a)}async function tabSwitch(e,t){const s=document.querySelectorAll(".tab"),n=document.querySelectorAll(".nav-tab"),i=document.getElementsByClassName("title")[0],a=document.getElementsByClassName("toolbar");let o=t,r=e.querySelector("span").textContent;if(s[o].classList.contains("fadeout")){refreshTabData(s[o]);for(var l=0;l<s.length;l++)l===o?(fadeIn(s[l]),n[l].classList.add("selected"),a[l].classList.remove("hide")):(fadeOut(s[l]),n[l].classList.remove("selected"),a[l].classList.add("hide"));i.textContent=r}}function setTabsListeners(e,t){e.addEventListener("click",(function(){tabSwitch(e,t)}))}function navTabs(){const e=document.querySelectorAll(".tab"),t=document.querySelectorAll(".nav-tab");t[0].classList.add("selected"),t.forEach(setTabsListeners),e.length!==t.length&&console.log("Erreur : pas le même nombre de tabs que de selectors.")}function themifySetText(){const e=document.getElementById("theme-text");if(null!=e){const t=document.body,s=document.getElementById("darkIcon"),n=document.getElementById("lightIcon");t.classList.contains("light")?(e.textContent="Light",s.style.display="none",n.style.display="block"):t.classList.contains("dark")&&(e.textContent="Dark",s.style.display="block",n.style.display="none")}}function themify(){const e=document.body;e.classList.contains("light")?(e.classList.replace("light","dark"),localStorage.setItem("theme","dark")):(e.classList.replace("dark","light"),localStorage.setItem("theme","light")),themifySetText()}function themifyCache(){const e=localStorage.getItem("theme"),t=localStorage.getItem("isSolar"),s=document.body;e&&s.classList.contains("light")&&(t&&s.classList.add("solar"),"light"!==e&&(s.classList.replace("light",e),themifySetText()))}function themifyListeners(){const e=document.getElementById("themify"),t=document.getElementById("solar"),s=document.body;e.addEventListener("click",themify),t.addEventListener("click",(function(){s.classList.toggle("solar"),s.classList.contains("solar")?localStorage.setItem("isSolar",!0):localStorage.removeItem("isSolar")})),themifySetText()}class WSConnection{#e=0;constructor(host){this.ws=new WebSocket(host),this.ws.onopen=()=>{this.ws.send(JSON.stringify({active:localStorage.getItem("active_tab")??null,email:login.email.input[0].value.trim(),password:login.currentPassword.input[0].value}))},this.ws.onmessage=e=>{const data=JSON.parse(e.data);if(console.log(data),0===this.#e)if(data.name)this.#e=1,login.head.classList.add("logged"),setTimeout((()=>{login.wrapper.className="login hidden",new ClassMain(data)}),300);else{let e,t;data>0?(e=data>2&&data<5?"warning":data>4?"danger":null,t=(7-data).toString(),data<7?msg.new({content:`Mot de passe erroné, essaie encore.\n                                Nombre d'essais restants : ${t}`,type:e,btn0listener:()=>{setTimeout((()=>login.currentPassword.input[0].focus()),10)}}):7===data&&msg.new({content:"Trop d'essais consécutifs, merci de patienter quelques minutes avant de réessayer."})):"-1"===data?msg.new({content:"Adresse mail invalide. Please try again, bitch.",type:"warning"}):"-2"===data?msg.new({content:"Pensez à valider la création de votre compte par email et SMS.",btn0listener:()=>login.blankBox()}):"-3"===data?msg.new({content:"Veuillez patienter quelques minutes avant votre prochain essai,\n                            ou réinitialisez votre mot de passe.",btn0listener:()=>login.blankBox()}):"-4"===data&&msg.new({content:"Votre compte n'est qu'un vugaire compte client, vous n'avez rien à faire par ici.",btn0listener:()=>login.blankBox(),type:"danger"})}else if(1===this.#e)if("string"===data.response?.fail)console.error(data.response.error),msg.new({content:data.response.fail,type:"warning"});else if(6===data.f){const divs=document.querySelectorAll(`fieldset[data-f='6'][data-t='${data.t}'] > div`),tableEvents=data.response.event??void 0,tables=Tabulator.findTable(`fieldset[data-f='6'][data-t='${data.t}'] > .tabulator`);if(delete data.response.event,tables)for(let e of tables)e.replaceData(data.response.data);for(let table of divs)if(!table.classList.contains("tabulator")){let tabu=new Tabulator(table,data.response);if(tableEvents)for(const tableEvent of tableEvents)tabu.on(tableEvent.listener,eval(tableEvent.action))}}else if([7,12].includes(data.f))8===data.s?BopChat.chats[0].parseData(data):Field.parseData(data);else if([8,9,10,11].includes(data.f))Modal.parseData(data);else if(13===data.f){if(data.i){const e={btn0listener:e=>{Modal.find(e.currentTarget).close(),socket.send({f:19,i:data.response.chat.id})},btn0style:"theme",btn0text:"fermer",btn1text:"supprimer",btn1style:"danger",btn1listener:()=>{msg.new({content:"Voulez-vous supprimer ce ticket ?",btn1text:"supprimer",btn1type:"warning",btn1listener:()=>{msg.new({content:"Under construction",type:"warning"}),msg.close()}})},btn2text:"appliquer",btn2style:"success",btn2listener:()=>{msg.new({content:"Under construction",type:"warning"})},fields:[{compact:!0,grid:"2/1/3/5",name:"Sujet",placeholder:"Sujet",type:"input_string",value:data.response.ticket.subject},{compact:!0,grid:"2/5/3/6",name:"État",task:7,type:"select",value:data.response.ticket.idstate},{compact:!0,grid:"2/6/3/7",name:"Priorité",task:6,type:"select",value:data.response.ticket.idpriority},{add:e=>{loadNewContact({childOf:e.closest("modal"),name:e.value,parentId:Array.from(e.closest(".modal").children).indexOf(e)})},compact:!0,grid:"3/5/4/6",multi:!1,name:"Client",placeholder:"Client",task:3,type:"selectize",value:data.response.client??void 0},{compact:!0,grid:"3/6/4/7",multi:!1,name:"Attribué à",placeholder:"Attribué à",task:4,type:"selectize",value:data.response.assignee??void 0},{compact:!0,grid:"4/5/5/7",name:"Type",task:5,type:"select",value:data.response.ticket.idtype[0].idticket_type},{add:e=>modalAddTag(e),compact:!0,grid:"5/5/6/7",label:"Tags",multi:!0,name:"Tags",placeholder:"Etiquettes",task:1,type:"selectize",value:data.response.ticket.tags},{compact:!0,grid:"3/1/7/5",name:"Description",placeholder:"Description",type:"quill",value:data.response.ticket.description}],grid:6,title:"Ticket #"+data.i};new Modal(e),BopChat.chats[0].wrapper.classList.add("toggle")}}else if(14===data.f)BopChat.chats[0].addChat(data.chat);else if(15===data.f)console.log(`user ${data.iduser} is typing in chat ${data.idchat}`);else if(16===data.f){const e=BopChat.chats[0];if(data.response.last&&!e.content.querySelector(`[data-i="${data.i}"] fieldset[data-t='${data.response.last.created}'][data-i='${data.response.last.iduser}']`))return socket.send({f:14,i:data.i});e.addMessage(data.response.new),"user"===e.content.getElementsByTagName("datalist")[0].querySelector(`[data-id='${data.response.new.iduser}']`).getAttribute("data-position")&&(e.input.value="",e.input.disabled=!1)}else 17===data.f?"request"===data.response.type?msg.new({type:"success",content:data.response.success,btn0text:"refuser",btn0listener:()=>{socket.send({c:data.response.chat,f:17,j:0,u:data.response.sender})},btn1text:"accepter",btn1listener:()=>{socket.send({c:data.response.chat,f:17,j:2,u:data.response.sender}),msg.close()},btn2text:"plus tard",btn2listener:()=>{socket.send({c:data.response.chat,f:17,j:1,u:data.response.sender})}}):"response"===data.response.type?(msg.new({content:"Requête acceptée !",type:"success"}),socket.send({f:14,i:data.response.chat})):"success"===data.response.type&&msg.new({content:data.response.success,type:"success"}):18===data.f?BopChat.chats[0].updateUsers(data.chat):19===data.f?data.chat.deserted?BopChat.chats[0].remove(data.chat.id):BopChat.chats[0].updateUsers(data.chat):20===data.f?ClassMain.el.parseTab(data.i,data.response):2501===data.f&&BopTable.parseData(data)},this.ws.onclose=e=>{this.#e=0,console.log("Connection closed, code: "+e.code+" reason: "+e.reason+"."),BopChat.destroyAll(),BopTable.destroyAll(),Modal.destroy(),ClassMain.el&&(ClassMain.destroy(),login.load()),1e3!==e.code&&msg.new({content:"La connexion avec le serveur a été interrompue.",type:"warning"})}}status(){return this.#e}readyState(){return this.ws.readyState}close(e){this.ws.close(1e3,e)}send(e){this.ws.send(JSON.stringify(e))}addEventListener(e){this.ws.addEventListener(e.type,e.action,e.options={})}}